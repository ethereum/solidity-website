<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><title>Feature Deep-Dive: User-Defined Operators | Solidity Programming Language</title><meta name="title" content="Feature Deep-Dive: User-Defined Operators | Solidity Programming Language"/><meta name="description" content="Posted by Kamil Śliwak, Matheus Aguiar on February 22, 2023"/><meta name="application-name" content="Solidity Programming Language"/><meta name="image" content="https://soliditylang.org/assets/siteicon.svg"/><meta property="og:title" content="Feature Deep-Dive: User-Defined Operators | Solidity Programming Language"/><meta property="og:description" content="Posted by Kamil Śliwak, Matheus Aguiar on February 22, 2023"/><meta property="og:type" content="website"/><meta property="og:site_name" content="Solidity Programming Language"/><meta property="og:url" content="https://soliditylang.org/blog/2023/02/22/user-defined-operators"/><meta property="og:image" content="https://soliditylang.org/assets/siteicon.svg"/><meta property="og:image:url" content="https://soliditylang.org/assets/siteicon.svg"/><meta property="og:image:secure_url" content="https://soliditylang.org/assets/siteicon.svg"/><meta property="og:image:alt" content="Solidity Programming Language"/><meta property="og:image:type" content="image/png"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="https://soliditylang.org/blog/2023/02/22/user-defined-operators"/><meta name="twitter:creator" content="@solidity_lang"/><meta name="twitter:site" content="@solidity_lang"/><meta name="twitter:title" content="Feature Deep-Dive: User-Defined Operators | Solidity Programming Language"/><meta name="twitter:description" content="Posted by Kamil Śliwak, Matheus Aguiar on February 22, 2023"/><meta name="twitter:image" content="https://soliditylang.org/assets/siteicon.svg/#"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" type="image/x-icon" href="/assets/favicon.ico"/><link rel="manifest" href="/manifest.json"/><meta name="next-head-count" content="26"/><link rel="preload" href="/fonts/overpass/overpass-regular.otf" as="font" crossorigin=""/><link rel="preload" href="/fonts/overpass/overpass-bold.otf" as="font" crossorigin=""/><link rel="preload" href="/fonts/overpass-mono/overpass-mono-regular.otf" as="font" crossorigin=""/><link rel="preload" href="/fonts/overpass-mono/overpass-mono-bold.otf" as="font" crossorigin=""/><link rel="preload" href="/_next/static/css/fd8cb407a7e59580.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fd8cb407a7e59580.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-76712b31cad968fc.js" defer=""></script><script src="/_next/static/chunks/framework-3b26078e74a9f85c.js" defer=""></script><script src="/_next/static/chunks/main-43580121531d6e57.js" defer=""></script><script src="/_next/static/chunks/pages/_app-dc3e3f1fe0793e54.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5BYYYY%5D/%5BMM%5D/%5BDD%5D/%5Bpost%5D-a4f40885d6eac172.js" defer=""></script><script src="/_next/static/Fngo94tbif38FilQuSLQv/_buildManifest.js" defer=""></script><script src="/_next/static/Fngo94tbif38FilQuSLQv/_ssgManifest.js" defer=""></script></head><body><script id="chakra-script">!(function(){try{var a=function(c){var v="(prefers-color-scheme: dark)",h=window.matchMedia(v).matches?"dark":"light",r=c==="system"?h:c,o=document.documentElement,s=document.body,l="chakra-ui-light",d="chakra-ui-dark",i=r==="dark";return s.classList.add(i?d:l),s.classList.remove(i?l:d),o.style.colorScheme=r,o.dataset.theme=r,r},n=a,m="system",e="chakra-ui-color-mode",t=localStorage.getItem(e);t?a(t):localStorage.setItem(e,a(m))}catch(a){}})();</script><div id="__next"><style data-emotion="css-global 1n5ab9x">:host,:root,[data-theme]{--chakra-ring-inset:var(--chakra-empty,/*!*/ /*!*/);--chakra-ring-offset-width:0px;--chakra-ring-offset-color:#fff;--chakra-ring-color:rgba(66, 153, 225, 0.6);--chakra-ring-offset-shadow:0 0 #0000;--chakra-ring-shadow:0 0 #0000;--chakra-space-x-reverse:0;--chakra-space-y-reverse:0;--chakra-colors-transparent:transparent;--chakra-colors-current:currentColor;--chakra-colors-black:#000000;--chakra-colors-white:#FFFFFF;--chakra-colors-whiteAlpha-50:rgba(255, 255, 255, 0.04);--chakra-colors-whiteAlpha-100:rgba(255, 255, 255, 0.06);--chakra-colors-whiteAlpha-200:rgba(255, 255, 255, 0.08);--chakra-colors-whiteAlpha-300:rgba(255, 255, 255, 0.16);--chakra-colors-whiteAlpha-400:rgba(255, 255, 255, 0.24);--chakra-colors-whiteAlpha-500:rgba(255, 255, 255, 0.36);--chakra-colors-whiteAlpha-600:rgba(255, 255, 255, 0.48);--chakra-colors-whiteAlpha-700:rgba(255, 255, 255, 0.64);--chakra-colors-whiteAlpha-800:rgba(255, 255, 255, 0.80);--chakra-colors-whiteAlpha-900:rgba(255, 255, 255, 0.92);--chakra-colors-blackAlpha-50:rgba(0, 0, 0, 0.04);--chakra-colors-blackAlpha-100:rgba(0, 0, 0, 0.06);--chakra-colors-blackAlpha-200:rgba(0, 0, 0, 0.08);--chakra-colors-blackAlpha-300:rgba(0, 0, 0, 0.16);--chakra-colors-blackAlpha-400:rgba(0, 0, 0, 0.24);--chakra-colors-blackAlpha-500:rgba(0, 0, 0, 0.36);--chakra-colors-blackAlpha-600:rgba(0, 0, 0, 0.48);--chakra-colors-blackAlpha-700:rgba(0, 0, 0, 0.64);--chakra-colors-blackAlpha-800:rgba(0, 0, 0, 0.80);--chakra-colors-blackAlpha-900:rgba(0, 0, 0, 0.92);--chakra-colors-gray-50:#FAF8FF;--chakra-colors-gray-100:#EDF2F7;--chakra-colors-gray-200:#E6E3EC;--chakra-colors-gray-300:#CBD5E0;--chakra-colors-gray-400:#A0AEC0;--chakra-colors-gray-500:#718096;--chakra-colors-gray-600:#4A5568;--chakra-colors-gray-700:#2D3748;--chakra-colors-gray-800:#1A202C;--chakra-colors-gray-900:#171923;--chakra-colors-red-50:#FFF5F5;--chakra-colors-red-100:#FED7D7;--chakra-colors-red-200:#FEB2B2;--chakra-colors-red-300:#FC8181;--chakra-colors-red-400:#F56565;--chakra-colors-red-500:#E53E3E;--chakra-colors-red-600:#C53030;--chakra-colors-red-700:#9B2C2C;--chakra-colors-red-800:#822727;--chakra-colors-red-900:#63171B;--chakra-colors-orange-50:#FFFAF0;--chakra-colors-orange-100:#FEEBC8;--chakra-colors-orange-200:#FBD38D;--chakra-colors-orange-300:#F6AD55;--chakra-colors-orange-400:#ED8936;--chakra-colors-orange-500:#DD6B20;--chakra-colors-orange-600:#C05621;--chakra-colors-orange-700:#9C4221;--chakra-colors-orange-800:#7B341E;--chakra-colors-orange-900:#652B19;--chakra-colors-yellow-50:#FFFFF0;--chakra-colors-yellow-100:#FEFCBF;--chakra-colors-yellow-200:#FAF089;--chakra-colors-yellow-300:#F6E05E;--chakra-colors-yellow-400:#ECC94B;--chakra-colors-yellow-500:#D69E2E;--chakra-colors-yellow-600:#B7791F;--chakra-colors-yellow-700:#975A16;--chakra-colors-yellow-800:#744210;--chakra-colors-yellow-900:#5F370E;--chakra-colors-green-50:#F0FFF4;--chakra-colors-green-100:#C6F6D5;--chakra-colors-green-200:#9AE6B4;--chakra-colors-green-300:#68D391;--chakra-colors-green-400:#48BB78;--chakra-colors-green-500:#38A169;--chakra-colors-green-600:#2F855A;--chakra-colors-green-700:#276749;--chakra-colors-green-800:#22543D;--chakra-colors-green-900:#1C4532;--chakra-colors-teal-50:#E6FFFA;--chakra-colors-teal-100:#B2F5EA;--chakra-colors-teal-200:#81E6D9;--chakra-colors-teal-300:#4FD1C5;--chakra-colors-teal-400:#38B2AC;--chakra-colors-teal-500:#319795;--chakra-colors-teal-600:#2C7A7B;--chakra-colors-teal-700:#285E61;--chakra-colors-teal-800:#234E52;--chakra-colors-teal-900:#1D4044;--chakra-colors-blue-50:#ebf8ff;--chakra-colors-blue-100:#bee3f8;--chakra-colors-blue-200:#AEC0F1;--chakra-colors-blue-300:#63b3ed;--chakra-colors-blue-400:#4299e1;--chakra-colors-blue-500:#3182ce;--chakra-colors-blue-600:#2b6cb0;--chakra-colors-blue-700:#2c5282;--chakra-colors-blue-800:#2a4365;--chakra-colors-blue-900:#110C4E;--chakra-colors-cyan-50:#EDFDFD;--chakra-colors-cyan-100:#C4F1F9;--chakra-colors-cyan-200:#9DECF9;--chakra-colors-cyan-300:#76E4F7;--chakra-colors-cyan-400:#0BC5EA;--chakra-colors-cyan-500:#00B5D8;--chakra-colors-cyan-600:#00A3C4;--chakra-colors-cyan-700:#0987A0;--chakra-colors-cyan-800:#086F83;--chakra-colors-cyan-900:#065666;--chakra-colors-purple-50:#FAF5FF;--chakra-colors-purple-100:#E9D8FD;--chakra-colors-purple-200:#D6BCFA;--chakra-colors-purple-300:#9F94E8;--chakra-colors-purple-400:#9F7AEA;--chakra-colors-purple-500:#5554D9;--chakra-colors-purple-600:#672AC8;--chakra-colors-purple-700:#553C9A;--chakra-colors-purple-800:#44337A;--chakra-colors-purple-900:#2B247C;--chakra-colors-pink-50:#FFF5F7;--chakra-colors-pink-100:#FED7E2;--chakra-colors-pink-200:#FBB6CE;--chakra-colors-pink-300:#F687B3;--chakra-colors-pink-400:#ED64A6;--chakra-colors-pink-500:#D53F8C;--chakra-colors-pink-600:#B83280;--chakra-colors-pink-700:#97266D;--chakra-colors-pink-800:#702459;--chakra-colors-pink-900:#521B41;--chakra-colors-linkedin-50:#E8F4F9;--chakra-colors-linkedin-100:#CFEDFB;--chakra-colors-linkedin-200:#9BDAF3;--chakra-colors-linkedin-300:#68C7EC;--chakra-colors-linkedin-400:#34B3E4;--chakra-colors-linkedin-500:#00A0DC;--chakra-colors-linkedin-600:#008CC9;--chakra-colors-linkedin-700:#0077B5;--chakra-colors-linkedin-800:#005E93;--chakra-colors-linkedin-900:#004471;--chakra-colors-facebook-50:#E8F4F9;--chakra-colors-facebook-100:#D9DEE9;--chakra-colors-facebook-200:#B7C2DA;--chakra-colors-facebook-300:#6482C0;--chakra-colors-facebook-400:#4267B2;--chakra-colors-facebook-500:#385898;--chakra-colors-facebook-600:#314E89;--chakra-colors-facebook-700:#29487D;--chakra-colors-facebook-800:#223B67;--chakra-colors-facebook-900:#1E355B;--chakra-colors-messenger-50:#D0E6FF;--chakra-colors-messenger-100:#B9DAFF;--chakra-colors-messenger-200:#A2CDFF;--chakra-colors-messenger-300:#7AB8FF;--chakra-colors-messenger-400:#2E90FF;--chakra-colors-messenger-500:#0078FF;--chakra-colors-messenger-600:#0063D1;--chakra-colors-messenger-700:#0052AC;--chakra-colors-messenger-800:#003C7E;--chakra-colors-messenger-900:#002C5C;--chakra-colors-whatsapp-50:#dffeec;--chakra-colors-whatsapp-100:#b9f5d0;--chakra-colors-whatsapp-200:#90edb3;--chakra-colors-whatsapp-300:#65e495;--chakra-colors-whatsapp-400:#3cdd78;--chakra-colors-whatsapp-500:#22c35e;--chakra-colors-whatsapp-600:#179848;--chakra-colors-whatsapp-700:#0c6c33;--chakra-colors-whatsapp-800:#01421c;--chakra-colors-whatsapp-900:#001803;--chakra-colors-twitter-50:#E5F4FD;--chakra-colors-twitter-100:#C8E9FB;--chakra-colors-twitter-200:#A8DCFA;--chakra-colors-twitter-300:#83CDF7;--chakra-colors-twitter-400:#57BBF5;--chakra-colors-twitter-500:#1DA1F2;--chakra-colors-twitter-600:#1A94DA;--chakra-colors-twitter-700:#1681BF;--chakra-colors-twitter-800:#136B9E;--chakra-colors-twitter-900:#0D4D71;--chakra-colors-telegram-50:#E3F2F9;--chakra-colors-telegram-100:#C5E4F3;--chakra-colors-telegram-200:#A2D4EC;--chakra-colors-telegram-300:#7AC1E4;--chakra-colors-telegram-400:#47A9DA;--chakra-colors-telegram-500:#0088CC;--chakra-colors-telegram-600:#007AB8;--chakra-colors-telegram-700:#006BA1;--chakra-colors-telegram-800:#005885;--chakra-colors-telegram-900:#003F5E;--chakra-borders-none:0;--chakra-borders-1px:1px solid;--chakra-borders-2px:2px solid;--chakra-borders-4px:4px solid;--chakra-borders-8px:8px solid;--chakra-fonts-heading:'Overpass',sans-serif;--chakra-fonts-body:'Overpass',sans-serif;--chakra-fonts-mono:'Overpass Mono',monospace;--chakra-fontSizes-3xs:0.45rem;--chakra-fontSizes-2xs:0.625rem;--chakra-fontSizes-xs:0.75rem;--chakra-fontSizes-sm:0.875rem;--chakra-fontSizes-md:1rem;--chakra-fontSizes-lg:1.125rem;--chakra-fontSizes-xl:1.25rem;--chakra-fontSizes-2xl:1.5rem;--chakra-fontSizes-3xl:2rem;--chakra-fontSizes-4xl:2.375rem;--chakra-fontSizes-5xl:2.75rem;--chakra-fontSizes-6xl:3.25rem;--chakra-fontSizes-7xl:4rem;--chakra-fontSizes-8xl:6rem;--chakra-fontSizes-9xl:8rem;--chakra-fontWeights-hairline:100;--chakra-fontWeights-thin:200;--chakra-fontWeights-light:300;--chakra-fontWeights-normal:400;--chakra-fontWeights-medium:500;--chakra-fontWeights-semibold:600;--chakra-fontWeights-bold:700;--chakra-fontWeights-extrabold:800;--chakra-fontWeights-black:900;--chakra-letterSpacings-tighter:-0.05em;--chakra-letterSpacings-tight:-0.025em;--chakra-letterSpacings-normal:0;--chakra-letterSpacings-wide:0.025em;--chakra-letterSpacings-wider:0.05em;--chakra-letterSpacings-widest:0.1em;--chakra-lineHeights-3:.75rem;--chakra-lineHeights-4:1rem;--chakra-lineHeights-5:1.25rem;--chakra-lineHeights-6:1.5rem;--chakra-lineHeights-7:1.75rem;--chakra-lineHeights-8:2rem;--chakra-lineHeights-9:2.25rem;--chakra-lineHeights-10:2.5rem;--chakra-lineHeights-normal:normal;--chakra-lineHeights-none:1;--chakra-lineHeights-shorter:1.25;--chakra-lineHeights-short:1.375;--chakra-lineHeights-base:1.5;--chakra-lineHeights-tall:1.625;--chakra-lineHeights-taller:2;--chakra-radii-none:0;--chakra-radii-sm:0.125rem;--chakra-radii-base:0.25rem;--chakra-radii-md:0.375rem;--chakra-radii-lg:0.5rem;--chakra-radii-xl:0.75rem;--chakra-radii-2xl:1rem;--chakra-radii-3xl:1.5rem;--chakra-radii-full:9999px;--chakra-space-1:0.25rem;--chakra-space-2:0.5rem;--chakra-space-3:0.75rem;--chakra-space-4:1rem;--chakra-space-5:1.25rem;--chakra-space-6:1.5rem;--chakra-space-7:1.75rem;--chakra-space-8:2rem;--chakra-space-9:2.25rem;--chakra-space-10:2.5rem;--chakra-space-12:3rem;--chakra-space-14:3.5rem;--chakra-space-16:4rem;--chakra-space-20:5rem;--chakra-space-24:6rem;--chakra-space-28:7rem;--chakra-space-32:8rem;--chakra-space-36:9rem;--chakra-space-40:10rem;--chakra-space-44:11rem;--chakra-space-48:12rem;--chakra-space-52:13rem;--chakra-space-56:14rem;--chakra-space-60:15rem;--chakra-space-64:16rem;--chakra-space-72:18rem;--chakra-space-80:20rem;--chakra-space-96:24rem;--chakra-space-px:1px;--chakra-space-0-5:0.125rem;--chakra-space-1-5:0.375rem;--chakra-space-2-5:0.625rem;--chakra-space-3-5:0.875rem;--chakra-shadows-xs:0 0 0 1px rgba(0, 0, 0, 0.05);--chakra-shadows-sm:0 1px 2px 0 rgba(0, 0, 0, 0.05);--chakra-shadows-base:0 1px 3px 0 rgba(0, 0, 0, 0.1),0 1px 2px 0 rgba(0, 0, 0, 0.06);--chakra-shadows-md:0 4px 6px -1px rgba(0, 0, 0, 0.1),0 2px 4px -1px rgba(0, 0, 0, 0.06);--chakra-shadows-lg:0 10px 15px -3px rgba(0, 0, 0, 0.1),0 4px 6px -2px rgba(0, 0, 0, 0.05);--chakra-shadows-xl:0 20px 25px -5px rgba(0, 0, 0, 0.1),0 10px 10px -5px rgba(0, 0, 0, 0.04);--chakra-shadows-2xl:0 25px 50px -12px rgba(0, 0, 0, 0.25);--chakra-shadows-outline:0 0 0 3px rgba(66, 153, 225, 0.6);--chakra-shadows-inner:inset 0 2px 4px 0 rgba(0,0,0,0.06);--chakra-shadows-none:none;--chakra-shadows-dark-lg:rgba(0, 0, 0, 0.1) 0px 0px 0px 1px,rgba(0, 0, 0, 0.2) 0px 5px 10px,rgba(0, 0, 0, 0.4) 0px 15px 40px;--chakra-sizes-1:0.25rem;--chakra-sizes-2:0.5rem;--chakra-sizes-3:0.75rem;--chakra-sizes-4:1rem;--chakra-sizes-5:1.25rem;--chakra-sizes-6:1.5rem;--chakra-sizes-7:1.75rem;--chakra-sizes-8:2rem;--chakra-sizes-9:2.25rem;--chakra-sizes-10:2.5rem;--chakra-sizes-12:3rem;--chakra-sizes-14:3.5rem;--chakra-sizes-16:4rem;--chakra-sizes-20:5rem;--chakra-sizes-24:6rem;--chakra-sizes-28:7rem;--chakra-sizes-32:8rem;--chakra-sizes-36:9rem;--chakra-sizes-40:10rem;--chakra-sizes-44:11rem;--chakra-sizes-48:12rem;--chakra-sizes-52:13rem;--chakra-sizes-56:14rem;--chakra-sizes-60:15rem;--chakra-sizes-64:16rem;--chakra-sizes-72:18rem;--chakra-sizes-80:20rem;--chakra-sizes-96:24rem;--chakra-sizes-px:1px;--chakra-sizes-0-5:0.125rem;--chakra-sizes-1-5:0.375rem;--chakra-sizes-2-5:0.625rem;--chakra-sizes-3-5:0.875rem;--chakra-sizes-max:max-content;--chakra-sizes-min:min-content;--chakra-sizes-full:100%;--chakra-sizes-3xs:14rem;--chakra-sizes-2xs:16rem;--chakra-sizes-xs:20rem;--chakra-sizes-sm:24rem;--chakra-sizes-md:28rem;--chakra-sizes-lg:32rem;--chakra-sizes-xl:36rem;--chakra-sizes-2xl:42rem;--chakra-sizes-3xl:48rem;--chakra-sizes-4xl:56rem;--chakra-sizes-5xl:64rem;--chakra-sizes-6xl:72rem;--chakra-sizes-7xl:80rem;--chakra-sizes-8xl:90rem;--chakra-sizes-prose:60ch;--chakra-sizes-container-sm:640px;--chakra-sizes-container-md:768px;--chakra-sizes-container-lg:1024px;--chakra-sizes-container-xl:1280px;--chakra-zIndices-hide:-1;--chakra-zIndices-auto:auto;--chakra-zIndices-base:0;--chakra-zIndices-docked:10;--chakra-zIndices-dropdown:1000;--chakra-zIndices-sticky:1100;--chakra-zIndices-banner:1200;--chakra-zIndices-overlay:1300;--chakra-zIndices-modal:1400;--chakra-zIndices-popover:1500;--chakra-zIndices-skipLink:1600;--chakra-zIndices-toast:1700;--chakra-zIndices-tooltip:1800;--chakra-transition-property-common:background-color,border-color,color,fill,stroke,opacity,box-shadow,transform;--chakra-transition-property-colors:background-color,border-color,color,fill,stroke;--chakra-transition-property-dimensions:width,height;--chakra-transition-property-position:left,right,top,bottom;--chakra-transition-property-background:background-color,background-image,background-position;--chakra-transition-easing-ease-in:cubic-bezier(0.4, 0, 1, 1);--chakra-transition-easing-ease-out:cubic-bezier(0, 0, 0.2, 1);--chakra-transition-easing-ease-in-out:cubic-bezier(0.4, 0, 0.2, 1);--chakra-transition-duration-ultra-fast:50ms;--chakra-transition-duration-faster:100ms;--chakra-transition-duration-fast:150ms;--chakra-transition-duration-normal:200ms;--chakra-transition-duration-slow:300ms;--chakra-transition-duration-slower:400ms;--chakra-transition-duration-ultra-slow:500ms;--chakra-blur-none:0;--chakra-blur-sm:4px;--chakra-blur-base:8px;--chakra-blur-md:12px;--chakra-blur-lg:16px;--chakra-blur-xl:24px;--chakra-blur-2xl:40px;--chakra-blur-3xl:64px;--chakra-colors-text:var(--chakra-colors-a);--chakra-colors-secondary:var(--chakra-colors-b);--chakra-colors-primary:var(--chakra-colors-c);--chakra-colors-highlight:var(--chakra-colors-d);--chakra-colors-bg:var(--chakra-colors-f);--chakra-colors-border:var(--chakra-colors-a);--chakra-colors-header:var(--chakra-colors-c);}.chakra-ui-light :host:not([data-theme]),.chakra-ui-light :root:not([data-theme]),.chakra-ui-light [data-theme]:not([data-theme]),[data-theme=light] :host:not([data-theme]),[data-theme=light] :root:not([data-theme]),[data-theme=light] [data-theme]:not([data-theme]),:host[data-theme=light],:root[data-theme=light],[data-theme][data-theme=light]{--chakra-colors-chakra-body-text:var(--chakra-colors-gray-800);--chakra-colors-chakra-body-bg:var(--chakra-colors-white);--chakra-colors-chakra-border-color:var(--chakra-colors-gray-200);--chakra-colors-chakra-subtle-bg:var(--chakra-colors-gray-100);--chakra-colors-chakra-placeholder-color:var(--chakra-colors-gray-500);--chakra-colors-a:var(--chakra-colors-purple-900);--chakra-colors-b:var(--chakra-colors-purple-600);--chakra-colors-c:var(--chakra-colors-purple-500);--chakra-colors-d:var(--chakra-colors-purple-300);--chakra-colors-e:var(--chakra-colors-blue-200);--chakra-colors-f:var(--chakra-colors-gray-200);--chakra-colors-mode:var(--chakra-colors-gray-50);--chakra-colors-error:var(--chakra-colors-red-500);}.chakra-ui-dark :host:not([data-theme]),.chakra-ui-dark :root:not([data-theme]),.chakra-ui-dark [data-theme]:not([data-theme]),[data-theme=dark] :host:not([data-theme]),[data-theme=dark] :root:not([data-theme]),[data-theme=dark] [data-theme]:not([data-theme]),:host[data-theme=dark],:root[data-theme=dark],[data-theme][data-theme=dark]{--chakra-colors-chakra-body-text:var(--chakra-colors-whiteAlpha-900);--chakra-colors-chakra-body-bg:var(--chakra-colors-gray-800);--chakra-colors-chakra-border-color:var(--chakra-colors-whiteAlpha-300);--chakra-colors-chakra-subtle-bg:var(--chakra-colors-gray-700);--chakra-colors-chakra-placeholder-color:var(--chakra-colors-whiteAlpha-400);--chakra-colors-a:var(--chakra-colors-gray-200);--chakra-colors-b:var(--chakra-colors-blue-200);--chakra-colors-c:var(--chakra-colors-purple-300);--chakra-colors-d:var(--chakra-colors-purple-500);--chakra-colors-e:var(--chakra-colors-purple-600);--chakra-colors-f:var(--chakra-colors-purple-900);--chakra-colors-mode:var(--chakra-colors-blue-900);--chakra-colors-error:var(--chakra-colors-red-300);}</style><style data-emotion="css-global 3kbdol">html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:system-ui,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;-moz-osx-font-smoothing:grayscale;touch-action:manipulation;}body{position:relative;min-height:100%;font-feature-settings:'kern';}*,*::before,*::after{border-width:0;border-style:solid;box-sizing:border-box;}main{display:block;}hr{border-top-width:1px;box-sizing:content-box;height:0;overflow:visible;}pre,code,kbd,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:1em;}a{background-color:transparent;color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bold;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none!important;}input[type="number"]{-moz-appearance:textfield;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-decoration{-webkit-appearance:none!important;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:-webkit-box;display:-webkit-list-item;display:-ms-list-itembox;display:list-item;}template{display:none;}[hidden]{display:none!important;}body,blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}button{background:transparent;padding:0;}fieldset{margin:0;padding:0;}ol,ul{margin:0;padding:0;}textarea{resize:vertical;}button,[role="button"]{cursor:pointer;}button::-moz-focus-inner{border:0!important;}table{border-collapse:collapse;}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;}img,svg,video,canvas,audio,iframe,embed,object{display:block;}img,video{max-width:100%;height:auto;}[data-js-focus-visible] :focus:not([data-focus-visible-added]):not([data-focus-visible-disabled]){outline:none;box-shadow:none;}select::-ms-expand{display:none;}:root{--chakra-vh:100vh;}@supports (height: -webkit-fill-available){:root{--chakra-vh:-webkit-fill-available;}}@supports (height: -moz-fill-available){:root{--chakra-vh:-moz-fill-available;}}@supports (height: 100dvh){:root{--chakra-vh:100dvh;}}</style><style data-emotion="css-global 1w6k1xa">body{font-family:var(--chakra-fonts-body);color:var(--chakra-colors-text);background:var(--chakra-colors-bg);transition-property:background-color;transition-duration:var(--chakra-transition-duration-normal);line-height:var(--chakra-lineHeights-base);-webkit-transition:background 200ms linear!important;transition:background 200ms linear!important;}*::-webkit-input-placeholder{color:var(--chakra-colors-chakra-placeholder-color);}*::-moz-placeholder{color:var(--chakra-colors-chakra-placeholder-color);}*:-ms-input-placeholder{color:var(--chakra-colors-chakra-placeholder-color);}*::placeholder{color:var(--chakra-colors-chakra-placeholder-color);}*,*::before,::after{border-color:var(--chakra-colors-chakra-border-color);word-wrap:break-word;}*{box-sizing:border-box;scroll-behavior:smooth;scroll-margin-top:5rem;padding:0px;margin:0px;}p{line-height:1.7;}p:not(:last-of-type){margin-bottom:var(--chakra-space-4);}</style><style data-emotion="css-global xhogr1">@import url("https://fonts.cdnfonts.com/css/overpass");@import url("https://fonts.cdnfonts.com/css/overpass-mono");</style><style data-emotion="css mglw4y">.css-mglw4y{font-family:var(--chakra-fonts-body);font-weight:regular;font-size:var(--chakra-fontSizes-md);color:var(--chakra-colors-text);max-width:var(--chakra-sizes-container-xl);-webkit-margin-start:auto;margin-inline-start:auto;-webkit-margin-end:auto;margin-inline-end:auto;}</style><div class="css-mglw4y"><style data-emotion="css 1xknj5">.css-1xknj5{position:fixed;top:0px;inset-inline:0px;height:72px;background:var(--chakra-colors-bg);z-index:1;-webkit-transition:background 200ms linear!important;transition:background 200ms linear!important;box-shadow:var(--chakra-shadows-md);}</style><div class="css-1xknj5" style="opacity:0"></div><style data-emotion="css 1n8t353">.css-1n8t353{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:-webkit-sticky;position:sticky;z-index:var(--chakra-zIndices-sticky);-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:end;justify-content:end;top:0px;-webkit-padding-start:var(--chakra-space-4);padding-inline-start:var(--chakra-space-4);-webkit-padding-end:var(--chakra-space-4);padding-inline-end:var(--chakra-space-4);padding-top:var(--chakra-space-4);padding-bottom:var(--chakra-space-4);background:var(--chakra-colors-transparent);-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);}@media screen and (min-width: 48em){.css-1n8t353{-webkit-padding-start:var(--chakra-space-8);padding-inline-start:var(--chakra-space-8);-webkit-padding-end:var(--chakra-space-8);padding-inline-end:var(--chakra-space-8);}}</style><div class="css-1n8t353"><style data-emotion="css e31vc0">.css-e31vc0{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:absolute;top:var(--chakra-space-4);left:var(--chakra-space-4);-webkit-align-items:end;-webkit-box-align:end;-ms-flex-align:end;align-items:end;transform-origin:top left;}@media screen and (min-width: 48em){.css-e31vc0{left:var(--chakra-space-8);}}</style><div class="css-e31vc0" style="transform:translateY(0px) scale(0.25) translateZ(0)"><style data-emotion="css 15y7iaj">.css-15y7iaj{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;color:inherit;-webkit-text-decoration:underline;text-decoration:underline;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;display:block;}.css-15y7iaj:focus-visible,.css-15y7iaj[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-15y7iaj:hover,.css-15y7iaj[data-hover]{color:var(--chakra-colors-primary);}</style><a class="chakra-link css-15y7iaj" aria-label="Go home" href="/"><style data-emotion="css 10om80z">.css-10om80z{width:100px;height:160px;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;vertical-align:middle;fill:currentColor;}</style><svg viewBox="0 0 100 160" focusable="false" class="chakra-icon css-10om80z"><path opacity="0.8" d="M50 44.3013L25 1L0 44.3013L25 87.6025L50 44.3013Z"></path><path opacity="0.45" d="M50 44.3091L75 1.00781L25 1.00781L0 44.3091H50Z"></path><path opacity="0.6" d="M75 1.00781L25 1.00781L50 44.3091H100L75 1.00781Z"></path><path opacity="0.8" d="M50 115.699L75 159L100 115.699L75 72.3975L50 115.699Z"></path><path opacity="0.45" d="M50 115.691L25 158.993H75L100 115.691L50 115.691Z"></path><path opacity="0.6" d="M25 158.993H75L50 115.691L0 115.691L25 158.993Z"></path></svg></a></div><style data-emotion="css 1gd6qsd">.css-1gd6qsd{pointer-events:none;margin:auto;opacity:0;-webkit-transition:opacity 200ms ease-in-out;transition:opacity 200ms ease-in-out;font-size:var(--chakra-fontSizes-sm);-webkit-padding-start:var(--chakra-space-1);padding-inline-start:var(--chakra-space-1);-webkit-padding-end:var(--chakra-space-1);padding-inline-end:var(--chakra-space-1);padding-top:var(--chakra-space-0-5);padding-bottom:var(--chakra-space-0-5);white-space:nowrap;display:none;}.css-1gd6qsd:focus,.css-1gd6qsd[data-focus]{opacity:1;-webkit-transition:opacity 200ms ease-in-out;transition:opacity 200ms ease-in-out;}@media screen and (min-width: 48em){.css-1gd6qsd{display:block;}}</style><a href="#content" class="css-1gd6qsd">{ <!-- -->skip to content<!-- --> }</a><style data-emotion="css 1tj8hf9">.css-1tj8hf9{display:none;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media screen and (min-width: 48em){.css-1tj8hf9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><nav class="css-1tj8hf9"><style data-emotion="css q8j7i">.css-q8j7i{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;color:inherit;-webkit-text-decoration:none;text-decoration:none;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;-webkit-padding-start:var(--chakra-space-2);padding-inline-start:var(--chakra-space-2);-webkit-padding-end:var(--chakra-space-2);padding-inline-end:var(--chakra-space-2);padding-top:var(--chakra-space-1);padding-bottom:var(--chakra-space-1);font-family:var(--chakra-fonts-mono);letter-spacing:-0.02em;background:var(--chakra-colors-mode);box-sizing:content-box;border-bottom:var(--chakra-borders-1px);border-color:var(--chakra-colors-transparent);font-size:var(--chakra-fontSizes-sm);}.css-q8j7i:focus-visible,.css-q8j7i[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-q8j7i:hover,.css-q8j7i[data-hover]{color:var(--chakra-colors-primary);border-color:var(--chakra-colors-primary);}</style><a class="chakra-link css-q8j7i" href="/blog">Blog</a><style data-emotion="css 13exh9n">.css-13exh9n{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;color:inherit;-webkit-text-decoration:none;text-decoration:none;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;-webkit-padding-start:var(--chakra-space-2);padding-inline-start:var(--chakra-space-2);-webkit-padding-end:var(--chakra-space-2);padding-inline-end:var(--chakra-space-2);padding-top:var(--chakra-space-1);padding-bottom:var(--chakra-space-1);font-family:var(--chakra-fonts-mono);letter-spacing:-0.02em;background:none;box-sizing:content-box;border-bottom:var(--chakra-borders-1px);border-color:var(--chakra-colors-transparent);font-size:var(--chakra-fontSizes-sm);}.css-13exh9n:focus-visible,.css-13exh9n[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-13exh9n:hover,.css-13exh9n[data-hover]{color:var(--chakra-colors-primary);border-color:var(--chakra-colors-primary);}</style><a class="chakra-link css-13exh9n" href="https://docs.soliditylang.org/?color=light">Documentation</a><a class="chakra-link css-13exh9n" href="/use-cases">Use cases</a><a class="chakra-link css-13exh9n" href="https://docs.soliditylang.org/en/latest/contributing.html?color=light">Contribute</a><a class="chakra-link css-13exh9n" href="/about">About</a><style data-emotion="css 1uu4y7h">.css-1uu4y7h{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;color:inherit;-webkit-text-decoration:none;text-decoration:none;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;-webkit-padding-start:var(--chakra-space-2);padding-inline-start:var(--chakra-space-2);-webkit-padding-end:var(--chakra-space-2);padding-inline-end:var(--chakra-space-2);padding-top:var(--chakra-space-1);padding-bottom:var(--chakra-space-1);font-family:var(--chakra-fonts-mono);letter-spacing:-0.02em;background:none;box-sizing:content-box;border-bottom:var(--chakra-borders-1px);border-color:var(--chakra-colors-transparent);font-size:var(--chakra-fontSizes-sm);}.css-1uu4y7h:focus-visible,.css-1uu4y7h[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-1uu4y7h::after{content:" ↗";white-space:nowrap;}.css-1uu4y7h:hover,.css-1uu4y7h[data-hover]{color:var(--chakra-colors-primary);border-color:var(--chakra-colors-primary);}</style><a target="_blank" rel="noopener" class="chakra-link css-1uu4y7h" href="https://forum.soliditylang.org/">Forum</a><style data-emotion="css phdjkr">.css-phdjkr{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:nowrap;vertical-align:middle;outline:2px solid transparent;outline-offset:2px;line-height:1.2;font-weight:var(--chakra-fontWeights-semibold);transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-normal);height:var(--chakra-sizes-10);min-width:var(--chakra-sizes-10);font-size:var(--chakra-fontSizes-md);-webkit-padding-start:var(--chakra-space-4);padding-inline-start:var(--chakra-space-4);-webkit-padding-end:var(--chakra-space-4);padding-inline-end:var(--chakra-space-4);padding:0px;border-radius:var(--chakra-radii-none);color:var(--chakra-colors-text);}.css-phdjkr:disabled,.css-phdjkr[disabled],.css-phdjkr[aria-disabled=true],.css-phdjkr[data-disabled]{opacity:0.4;cursor:not-allowed;box-shadow:var(--chakra-shadows-none);}.css-phdjkr:active,.css-phdjkr[data-active]{background:var(--chakra-colors-gray-200);}.css-phdjkr:hover,.css-phdjkr[data-hover]{background:none;color:var(--chakra-colors-primary);}.css-phdjkr:focus-visible{outline:2px solid var(--chakra-colors-primary);outline-offset:-6px;}</style><button type="button" class="chakra-button css-phdjkr" aria-label="Toggle light/dark"><style data-emotion="css onkibi">.css-onkibi{width:1em;height:1em;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;vertical-align:middle;}</style><svg viewBox="0 0 24 24" focusable="false" class="chakra-icon css-onkibi" aria-hidden="true"><path fill="currentColor" d="M21.4,13.7C20.6,13.9,19.8,14,19,14c-5,0-9-4-9-9c0-0.8,0.1-1.6,0.3-2.4c0.1-0.3,0-0.7-0.3-1 c-0.3-0.3-0.6-0.4-1-0.3C4.3,2.7,1,7.1,1,12c0,6.1,4.9,11,11,11c4.9,0,9.3-3.3,10.6-8.1c0.1-0.3,0-0.7-0.3-1 C22.1,13.7,21.7,13.6,21.4,13.7z"></path></svg></button></nav><style data-emotion="css 1r91fyb">.css-1r91fyb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:var(--chakra-space-2);}@media screen and (min-width: 48em){.css-1r91fyb{display:none;}}</style><nav class="css-1r91fyb"><button type="button" class="chakra-button css-phdjkr" aria-label="Toggle light/dark"><svg viewBox="0 0 24 24" focusable="false" class="chakra-icon css-onkibi" aria-hidden="true"><path fill="currentColor" d="M21.4,13.7C20.6,13.9,19.8,14,19,14c-5,0-9-4-9-9c0-0.8,0.1-1.6,0.3-2.4c0.1-0.3,0-0.7-0.3-1 c-0.3-0.3-0.6-0.4-1-0.3C4.3,2.7,1,7.1,1,12c0,6.1,4.9,11,11,11c4.9,0,9.3-3.3,10.6-8.1c0.1-0.3,0-0.7-0.3-1 C22.1,13.7,21.7,13.6,21.4,13.7z"></path></svg></button><button type="button" class="chakra-button css-phdjkr" aria-label="Open menu"><svg viewBox="0 0 24 24" focusable="false" class="chakra-icon css-onkibi" aria-hidden="true"><path fill="currentColor" d="M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"></path></svg></button></nav></div><style data-emotion="css 1iv88bz">.css-1iv88bz{-webkit-padding-start:var(--chakra-space-4);padding-inline-start:var(--chakra-space-4);-webkit-padding-end:var(--chakra-space-4);padding-inline-end:var(--chakra-space-4);}@media screen and (min-width: 48em){.css-1iv88bz{-webkit-padding-start:var(--chakra-space-8);padding-inline-start:var(--chakra-space-8);-webkit-padding-end:var(--chakra-space-8);padding-inline-end:var(--chakra-space-8);}}</style><main id="content" class="css-1iv88bz"><style data-emotion="css 1n6ulww">.css-1n6ulww{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-padding-start:0px;padding-inline-start:0px;-webkit-padding-end:0px;padding-inline-end:0px;padding-top:var(--chakra-space-28);padding-bottom:var(--chakra-space-20);}@media screen and (min-width: 48em){.css-1n6ulww{padding-top:var(--chakra-space-56);}}@media screen and (min-width: 62em){.css-1n6ulww{padding-bottom:var(--chakra-space-24);}}</style><section class="css-1n6ulww"><style data-emotion="css 18iy9i4">.css-18iy9i4{font-family:var(--chakra-fonts-mono);font-weight:700;font-size:var(--chakra-fontSizes-5xl);line-height:1.1;text-wrap:balance;color:var(--chakra-colors-text);margin-bottom:var(--chakra-space-1);}</style><h1 class="chakra-text css-18iy9i4">Feature Deep-Dive: User-Defined Operators</h1><style data-emotion="css 8ad9fq">.css-8ad9fq{color:var(--chakra-colors-primary);margin-bottom:var(--chakra-space-6);}</style><p class="chakra-text css-8ad9fq">Posted by Kamil Śliwak, Matheus Aguiar on February 22, 2023</p><style data-emotion="css 1cyfw3r">.css-1cyfw3r{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;color:inherit;-webkit-text-decoration:none!important;text-decoration:none!important;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;margin-bottom:0px;display:block;border-radius:var(--chakra-radii-full);}.css-1cyfw3r:focus-visible,.css-1cyfw3r[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-1cyfw3r:hover,.css-1cyfw3r[data-hover]{color:var(--chakra-colors-primary);}</style><a class="chakra-link css-1cyfw3r" data-group="true" href="/blog/category/explainers"><style data-emotion="css 1xslh9a">.css-1xslh9a{border-radius:var(--chakra-radii-full);-webkit-padding-start:var(--chakra-space-3);padding-inline-start:var(--chakra-space-3);-webkit-padding-end:var(--chakra-space-3);padding-inline-end:var(--chakra-space-3);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;border:var(--chakra-borders-1px);border-color:var(--chakra-colors-primary);color:var(--chakra-colors-primary);font-size:var(--chakra-fontSizes-xs);font-family:var(--chakra-fonts-mono);font-weight:var(--chakra-fontWeights-bold);text-transform:uppercase;white-space:nowrap;}[role=group]:hover .css-1xslh9a,[role=group][data-hover] .css-1xslh9a,[data-group]:hover .css-1xslh9a,[data-group][data-hover] .css-1xslh9a,.group:hover .css-1xslh9a,.group[data-hover] .css-1xslh9a{background:var(--chakra-colors-primary);color:var(--chakra-colors-bg);}</style><div class="css-1xslh9a">Explainers</div></a></section><style data-emotion="css 1axt0os">.css-1axt0os{max-width:var(--chakra-sizes-container-md);}</style><article class="css-1axt0os"><style data-emotion="css 1t48wb1">.css-1t48wb1{font-size:var(--chakra-fontSizes-md);line-height:150%;margin-bottom:var(--chakra-space-4);}@media screen and (min-width: 48em){.css-1t48wb1{margin-bottom:var(--chakra-space-6);}}</style><p class="chakra-text css-1t48wb1">The highlight of <style data-emotion="css aa1u6n">.css-aa1u6n{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;-webkit-text-decoration:underline;text-decoration:underline;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;font-family:var(--chakra-fonts-body);font-weight:regular;font-size:inherit;color:var(--chakra-colors-secondary);}.css-aa1u6n:focus-visible,.css-aa1u6n[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-aa1u6n::after{content:" ↗";white-space:nowrap;}.css-aa1u6n:hover,.css-aa1u6n[data-hover]{color:var(--chakra-colors-primary);}</style><a target="_blank" rel="noopener" class="chakra-link css-aa1u6n" href="https://github.com/ethereum/solidity/releases/tag/v0.8.19">Solidity 0.8.19</a> release
is the support for defining <em class="chakra-text css-0">operators</em> on <style data-emotion="css 3ea0e8">.css-3ea0e8{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;-webkit-text-decoration:underline;text-decoration:underline;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;font-family:var(--chakra-fonts-body);font-weight:regular;font-size:inherit;color:var(--chakra-colors-secondary);}.css-3ea0e8:focus-visible,.css-3ea0e8[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-3ea0e8:hover,.css-3ea0e8[data-hover]{color:var(--chakra-colors-primary);}</style><a class="chakra-link css-3ea0e8" href="https://docs.soliditylang.org/en/latest/types.html?color=light#user-defined-value-types">user-defined value types</a> (UDVTs).</p>
<p class="chakra-text css-1t48wb1">If you have not been keeping up with recent features, UDVTs are a new class of types introduced in Solidity 0.8.8.
They provide an abstraction over an elementary value type that results in a completely new type.
This is similar to creating an alias, but the new type is distinct from the underlying value type
and all other UDVTs derived from that underlying type.
The ability to use operators is meant to bring the UDVTs closer to being as natural to use as the
built-in types and promote the use of type-safe interfaces.
Below, we are going to take a closer look into the details of this new mechanism.</p>
<style data-emotion="css xeg9ae">.css-xeg9ae{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-fontWeights-bold);font-size:var(--chakra-fontSizes-3xl);line-height:1.33;text-wrap:balance;margin-bottom:var(--chakra-space-4);color:var(--chakra-colors-text);margin-top:var(--chakra-space-12);}@media screen and (min-width: 48em){.css-xeg9ae{font-size:var(--chakra-fontSizes-4xl);line-height:1.2;margin-top:var(--chakra-space-16);margin-bottom:var(--chakra-space-6);}}</style><h3 class="chakra-heading css-xeg9ae">A Quick Refresher</h3>
<p class="chakra-text css-1t48wb1">Before we get into the details of the new feature and how it affects the language, it may be a good
idea to first go over the two existing features that it builds upon: built-in operators and <style data-emotion="css 167an7n">.css-167an7n{-webkit-padding-start:var(--chakra-space-1);padding-inline-start:var(--chakra-space-1);-webkit-padding-end:var(--chakra-space-1);padding-inline-end:var(--chakra-space-1);padding-top:var(--chakra-space-0-5);padding-bottom:var(--chakra-space-0-5);font-size:0.875em;font-family:var(--chakra-fonts-mono);background:var(--chakra-colors-mode);color:var(--chakra-colors-primary);}</style><span class="chakra-text css-167an7n">using for</span>.</p>
<style data-emotion="css w2m4nu">.css-w2m4nu{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-fontWeights-bold);font-size:var(--chakra-fontSizes-3xl);line-height:1.33;text-wrap:balance;color:var(--chakra-colors-text);margin-top:var(--chakra-space-8);margin-bottom:var(--chakra-space-4);}@media screen and (min-width: 48em){.css-w2m4nu{font-size:var(--chakra-fontSizes-4xl);line-height:1.2;margin-top:var(--chakra-space-12);margin-bottom:var(--chakra-space-6);}}</style><h4 class="chakra-heading css-w2m4nu">Built-in Operators</h4>
<p class="chakra-text css-1t48wb1">Solidity, like the vast majority of programming languages,
<a class="chakra-link css-3ea0e8" href="https://docs.soliditylang.org/en/latest/types.html?color=light#operators">offers a set of operators</a> as syntactic sugar
over common arithmetical and logical functions.
The difference between operators and functions is purely syntactical, and the decision
to choose one over the other is to a large extent a matter of readability.
The use of operators makes expressions more concise, which is helpful as long as they are well
understood by the reader.
What is included in that set varies widely from language to language.</p>
<p class="chakra-text css-1t48wb1">Here is the full list for Solidity:</p>
<style data-emotion="css 5605sr">.css-5605sr{font-variant-numeric:lining-nums tabular-nums;border-collapse:collapse;width:var(--chakra-sizes-full);}</style><table class="chakra-table css-5605sr" node="[object Object]"><thead node="[object Object]" class="css-0"><tr class="css-0"><style data-emotion="css 1zts0j">.css-1zts0j{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-fontWeights-bold);text-transform:uppercase;letter-spacing:var(--chakra-letterSpacings-wider);text-align:start;-webkit-padding-start:var(--chakra-space-6);padding-inline-start:var(--chakra-space-6);-webkit-padding-end:var(--chakra-space-6);padding-inline-end:var(--chakra-space-6);padding-top:var(--chakra-space-3);padding-bottom:var(--chakra-space-3);line-height:var(--chakra-lineHeights-4);font-size:var(--chakra-fontSizes-xs);color:var(--chakra-colors-gray-600);border-bottom:var(--chakra-borders-1px);border-color:var(--chakra-colors-gray-100);}.css-1zts0j[data-is-numeric=true]{text-align:end;}</style><th class="css-1zts0j">Category</th><th class="css-1zts0j">Operators</th></tr></thead><tbody node="[object Object]" class="css-0"><tr class="css-0"><style data-emotion="css xumdn4">.css-xumdn4{text-align:start;-webkit-padding-start:var(--chakra-space-6);padding-inline-start:var(--chakra-space-6);-webkit-padding-end:var(--chakra-space-6);padding-inline-end:var(--chakra-space-6);padding-top:var(--chakra-space-4);padding-bottom:var(--chakra-space-4);line-height:var(--chakra-lineHeights-5);border-bottom:var(--chakra-borders-1px);border-color:var(--chakra-colors-gray-100);}.css-xumdn4[data-is-numeric=true]{text-align:end;}</style><td class="css-xumdn4">Bitwise</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">&amp;</span>, <span class="chakra-text css-167an7n">|</span>, <span class="chakra-text css-167an7n">^</span>, <span class="chakra-text css-167an7n">&lt;&lt;</span>, <span class="chakra-text css-167an7n">&gt;&gt;</span>, <span class="chakra-text css-167an7n">~</span></td></tr><tr class="css-0"><td class="css-xumdn4">Arithmetic</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">+</span>, <span class="chakra-text css-167an7n">-</span>, <span class="chakra-text css-167an7n">*</span>, <span class="chakra-text css-167an7n">/</span>, <span class="chakra-text css-167an7n">%</span>, <span class="chakra-text css-167an7n">**</span></td></tr><tr class="css-0"><td class="css-xumdn4">Comparison</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">==</span>, <span class="chakra-text css-167an7n">!=</span>, <span class="chakra-text css-167an7n">&lt;</span>, <span class="chakra-text css-167an7n">&lt;=</span>, <span class="chakra-text css-167an7n">&gt;</span>, <span class="chakra-text css-167an7n">&gt;=</span></td></tr><tr class="css-0"><td class="css-xumdn4">Boolean</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">!</span>, <span class="chakra-text css-167an7n">&amp;&amp;</span>, <span class="chakra-text css-167an7n">||</span></td></tr><tr class="css-0"><td class="css-xumdn4">Increment/decrement</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">++</span>, <span class="chakra-text css-167an7n">--</span></td></tr><tr class="css-0"><td class="css-xumdn4">Simple assignment</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">=</span></td></tr><tr class="css-0"><td class="css-xumdn4">Composite assignment</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">+=</span>, <span class="chakra-text css-167an7n">-=</span>, <span class="chakra-text css-167an7n">^=</span>, <span class="chakra-text css-167an7n">*=</span>, <span class="chakra-text css-167an7n">/=</span>, <span class="chakra-text css-167an7n">%=</span>, <span class="chakra-text css-167an7n">&amp;=</span>, <span class="chakra-text css-167an7n">|=</span>, <span class="chakra-text css-167an7n">^=</span>, <span class="chakra-text css-167an7n">&lt;&lt;=</span>, <span class="chakra-text css-167an7n">&gt;&gt;=</span></td></tr><tr class="css-0"><td class="css-xumdn4">Miscellaneous</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">delete</span>, <span class="chakra-text css-167an7n">new</span>, <span class="chakra-text css-167an7n">.</span>, <span class="chakra-text css-167an7n">()</span>, <span class="chakra-text css-167an7n">[]</span>, <span class="chakra-text css-167an7n">?:</span></td></tr></tbody></table>
<p class="chakra-text css-1t48wb1">It is important to note that in many languages, an assignment is a statement that is handled in a special way.
In Solidity, like in the C-like languages it took inspiration from, an assignment operator can be freely used in
expressions on par with other operators.</p>
<p class="chakra-text css-1t48wb1">In most cases, built-in operators are only defined for <a class="chakra-link css-3ea0e8" href="https://docs.soliditylang.org/en/latest/types.html?color=light#value-types">value types</a>.
Notable exceptions are the simple assignment and the &quot;miscellaneous&quot; group.
For example, you can put almost anything in parentheses or branches of the ternary operator, as a part
of a bigger expression, even if its type cannot be named or even assigned to anything.</p>
<h4 class="chakra-heading css-w2m4nu"><span class="chakra-text css-167an7n">using for</span></h4>
<p class="chakra-text css-1t48wb1">Since operators are a purely syntactic element, you can always use a function as a substitute.
Solidity has a mechanism that is often used this way:
<a class="chakra-link css-3ea0e8" href="https://docs.soliditylang.org/en/latest/contracts.html?color=light#using-for"><span class="chakra-text css-167an7n">using for</span></a>.</p>
<p class="chakra-text css-1t48wb1">The directive <span class="chakra-text css-167an7n">using ... for ...</span> can be used to attach functions to a type.
These functions can then be used as members on any object of that type and receive the object as
their first parameter.</p>
<style data-emotion="css 1uyok63">.css-1uyok63{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin-bottom:var(--chakra-space-5);}.css-1uyok63>*:not(style)~*:not(style){margin-top:0.5rem;-webkit-margin-end:0px;margin-inline-end:0px;margin-bottom:0px;-webkit-margin-start:0px;margin-inline-start:0px;}</style><div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">pragma</span><span> </span><span class="token" style="color:#07a">solidity</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">^</span><span class="token version" style="color:#905">0.8.13</span><span class="token" style="color:#999">;</span><span>
</span>
<span>type Int </span><span class="token" style="color:#07a">is</span><span> </span><span class="token" style="color:#690">int</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>add</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Int global</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>Int a</span><span class="token" style="color:#999">,</span><span> Int b</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Int</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">return</span><span> Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>a</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>b</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">test</span><span class="token" style="color:#999">(</span><span>Int a</span><span class="token" style="color:#999">,</span><span> Int b</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Int</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">return</span><span> a</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>b</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1">Currently, <span class="chakra-text css-167an7n">using for</span> has 3 forms:</p>
<style data-emotion="css 13a5a39">.css-13a5a39{list-style-type:decimal;-webkit-margin-start:1em;margin-inline-start:1em;padding-left:var(--chakra-space-4);}.css-13a5a39>*:not(style)~*:not(style){margin-top:var(--chakra-space-2);}</style><ol role="list" class="css-13a5a39"><style data-emotion="css cvpopp">.css-cvpopp{list-style-type:inherit;}</style><li class="css-cvpopp"><span class="chakra-text css-167an7n">using L for T</span>: attaches all non-private functions from library <span class="chakra-text css-167an7n">L</span> to type <span class="chakra-text css-167an7n">T</span>.</li><li class="css-cvpopp"><span class="chakra-text css-167an7n">using L for *</span>: attaches all non-private functions from library <span class="chakra-text css-167an7n">L</span> to any type, including types that
cannot be named in the language and used explicitly (e.g. types of literals or array slices).</li><li class="css-cvpopp"><span class="chakra-text css-167an7n">using {f, L.g, ...} for T</span>: attaches given free or library functions <span class="chakra-text css-167an7n">f</span>, <span class="chakra-text css-167an7n">L.g</span>, ... to type <span class="chakra-text css-167an7n">T</span>.</li></ol>
<p class="chakra-text css-1t48wb1">The directive can be used:</p>
<style data-emotion="css 19qh3zo">.css-19qh3zo{list-style-type:disc;-webkit-margin-start:1em;margin-inline-start:1em;padding-left:var(--chakra-space-4);}.css-19qh3zo>*:not(style)~*:not(style){margin-top:var(--chakra-space-2);}</style><ul role="list" class="css-19qh3zo"><li class="css-cvpopp">✅ At file level.</li><li class="css-cvpopp">✅ Inside contract and library definitions.</li></ul>
<p class="chakra-text css-1t48wb1">The directive can not be used:</p>
<ul role="list" class="css-19qh3zo"><li class="css-cvpopp">❌ Inside interface definitions.</li></ul>
<p class="chakra-text css-1t48wb1">When used inside contracts, it is not inherited.
Its effects extend only to the contract that has it and not to any other contracts derived from it.</p>
<p class="chakra-text css-1t48wb1">At file level, the directive affects all the free functions, contracts and libraries defined within that file.
It does not affect other files that import the file containing it, unless it is marked as <span class="chakra-text css-167an7n">global</span>.
<span class="chakra-text css-167an7n">global</span> extends its effect to all files.
The use of <span class="chakra-text css-167an7n">global</span> is possible only with UDVTs, structs, and enums that are defined in its source unit.</p>
<h3 class="chakra-heading css-xeg9ae">Introducing User-Defined Operators</h3>
<p class="chakra-text css-1t48wb1">The new feature extends the third form of the <span class="chakra-text css-167an7n">using for</span> syntax to allow binding operators to functions.
The function is invoked whenever the operator is used on the values of the type:</p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">pragma</span><span> </span><span class="token" style="color:#07a">solidity</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">^</span><span class="token version" style="color:#905">0.8.19</span><span class="token" style="color:#999">;</span><span>
</span>
<span>type Int </span><span class="token" style="color:#07a">is</span><span> </span><span class="token" style="color:#690">int</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>add </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Int global</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>Int a</span><span class="token" style="color:#999">,</span><span> Int b</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Int</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">return</span><span> Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>a</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>b</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">test</span><span class="token" style="color:#999">(</span><span>Int a</span><span class="token" style="color:#999">,</span><span> Int b</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Int</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">return</span><span> a </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> b</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:slategray">// Equivalent to add(a, b)</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1">An operator can only be bound in a <span class="chakra-text css-167an7n">global</span> directive and its definition must be a <span class="chakra-text css-167an7n">pure</span> free function.
The type specified in <span class="chakra-text css-167an7n">using for</span> must be a user-defined value type and must be the type
of all the parameters of the function and its return value.
The only exception are comparison operator definitions, where the return type must be <span class="chakra-text css-167an7n">bool</span>.</p>
<p class="chakra-text css-1t48wb1">Since currently there are no implicit conversions allowed to and from UDVTs, user-defined operators
must always be invoked with exact types.</p>
<p class="chakra-text css-1t48wb1">The following operators can be defined:</p>
<table class="chakra-table css-5605sr" node="[object Object]"><thead node="[object Object]" class="css-0"><tr class="css-0"><th class="css-1zts0j">Category</th><th class="css-1zts0j">Operators</th></tr></thead><tbody node="[object Object]" class="css-0"><tr class="css-0"><td class="css-xumdn4">Bitwise</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">&amp;</span>, <span class="chakra-text css-167an7n">|</span>, <span class="chakra-text css-167an7n">^</span>, <span class="chakra-text css-167an7n">~</span></td></tr><tr class="css-0"><td class="css-xumdn4">Arithmetic</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">+</span>, <span class="chakra-text css-167an7n">-</span>, <span class="chakra-text css-167an7n">*</span>, <span class="chakra-text css-167an7n">/</span>, <span class="chakra-text css-167an7n">%</span></td></tr><tr class="css-0"><td class="css-xumdn4">Comparison</td><td class="css-xumdn4"><span class="chakra-text css-167an7n">==</span>, <span class="chakra-text css-167an7n">!=</span>, <span class="chakra-text css-167an7n">&lt;</span>, <span class="chakra-text css-167an7n">&lt;=</span>, <span class="chakra-text css-167an7n">&gt;</span>, <span class="chakra-text css-167an7n">&gt;=</span></td></tr></tbody></table>
<p class="chakra-text css-1t48wb1">Of the operators listed above, <span class="chakra-text css-167an7n">~</span> is unary, <span class="chakra-text css-167an7n">-</span> can be both unary and binary and the rest is always binary.
Note that Solidity does not have a unary <span class="chakra-text css-167an7n">+</span>.
Unary and binary <span class="chakra-text css-167an7n">-</span> are considered different operators and need separate definitions.
Whether <span class="chakra-text css-167an7n">-</span> refers to the unary or binary variant depends on the number of parameters of the function.</p>
<p class="chakra-text css-1t48wb1">It is not possible to replace operator definitions.
This applies both to the built-in operator definitions provided by the compiler and to operators
bound to a function provided by the user.
Once the operator is bound, the definition cannot be changed.</p>
<h4 class="chakra-heading css-w2m4nu">Operator Bindings vs Attached Functions</h4>
<p class="chakra-text css-1t48wb1">User-defined operators are independent of attached functions.
One can be done without the other, and both can be done simultaneously, even in the same <span class="chakra-text css-167an7n">using for</span> directive.</p>
<p class="chakra-text css-1t48wb1">The following example illustrates this:</p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">pragma</span><span> </span><span class="token" style="color:#07a">solidity</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">^</span><span class="token version" style="color:#905">0.8.19</span><span class="token" style="color:#999">;</span><span>
</span>
<span>type Int </span><span class="token" style="color:#07a">is</span><span> </span><span class="token" style="color:#690">int</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>add </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Int global</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>sub </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span class="token" style="color:#999">,</span><span> sub</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Int global</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>Int a</span><span class="token" style="color:#999">,</span><span> Int b</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Int</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">return</span><span> Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>a</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>b</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">sub</span><span class="token" style="color:#999">(</span><span>Int a</span><span class="token" style="color:#999">,</span><span> Int b</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Int</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">return</span><span> Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>a</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span> Int</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>b</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">test</span><span class="token" style="color:#999">(</span><span>Int x</span><span class="token" style="color:#999">,</span><span> Int y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    x </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> y</span><span class="token" style="color:#999">;</span><span>
</span><span>    x</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:slategray">// ERROR: Member &quot;add&quot; not found or not visible after argument-dependent lookup in Int.</span><span>
</span>
<span>    x </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span> y</span><span class="token" style="color:#999">;</span><span>
</span><span>    x</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">sub</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:slategray">// OK -- &quot;sub&quot; was also attached in &quot;using for&quot;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1">In the above example, the function <span class="chakra-text css-167an7n">add()</span> is used <em class="chakra-text css-0">only</em> as the operator <span class="chakra-text css-167an7n">+</span>, and not callable as <span class="chakra-text css-167an7n">x.add(y)</span>
(but it can, of course, be also called as <span class="chakra-text css-167an7n">add(x, y)</span>).
<span class="chakra-text css-167an7n">sub()</span>, on the other hand, can both be used as the operator <span class="chakra-text css-167an7n">-</span> and called on the type.</p>
<p class="chakra-text css-1t48wb1">The rules for <span class="chakra-text css-167an7n">using for global</span> with operators are the same as for attached functions
(with an additional restriction that operators <em class="chakra-text css-0">must</em> be global), i.e.
it is only allowed at file level, the type must be defined in the same file and it makes
the operator available everywhere.
Note that only the directive itself must be colocated with the type.
The operator definitions may be imported from a separate file.</p>
<h4 class="chakra-heading css-w2m4nu">Parameter Cleanup</h4>
<p class="chakra-text css-1t48wb1">If you decide to use inline assembly in your operator implementation, you should be aware of
a dangerous pitfall when using types that do not fill the whole stack slot.
Accessing Solidity variables in inline assembly bypasses the
<a class="chakra-link css-3ea0e8" href="https://docs.soliditylang.org/en/latest/internals/variable_cleanup.html?color=light">variable cleanup</a>
mechanism that normally masks the dirty bits of your value.
In inline assembly you must perform that cleanup manually.</p>
<p class="chakra-text css-1t48wb1">Consider an example that naively accesses the parameters and return values of operators
without properly cleaning up <span class="chakra-text css-167an7n">uint8</span> values:</p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">pragma</span><span> </span><span class="token" style="color:#07a">solidity</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">^</span><span class="token version" style="color:#905">0.8.19</span><span class="token" style="color:#999">;</span><span>
</span>
<span>type U8 </span><span class="token" style="color:#07a">is</span><span> </span><span class="token" style="color:#690">uint8</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>yoloAdd </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span class="token" style="color:#999">,</span><span> yoloDiv </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> U8 global</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">yoloAdd</span><span class="token" style="color:#999">(</span><span>U8 x</span><span class="token" style="color:#999">,</span><span> U8 y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>U8 z</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">assembly</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        z </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:=</span><span> </span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">,</span><span> y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:slategray">// Wrong! No cleanup.</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">yoloDiv</span><span class="token" style="color:#999">(</span><span>U8 x</span><span class="token" style="color:#999">,</span><span> U8 y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>U8 z</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">assembly</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        z </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:=</span><span> </span><span class="token" style="color:#DD4A68">div</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">,</span><span> y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:slategray">// Wrong! No cleanup.</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">contract</span><span> </span><span class="token" style="color:#DD4A68">C</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">divAddNoOverflow</span><span class="token" style="color:#999">(</span><span>U8 a</span><span class="token" style="color:#999">,</span><span> U8 b</span><span class="token" style="color:#999">,</span><span> U8 c</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">external</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>U8</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> a </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span> </span><span class="token" style="color:#999">(</span><span>b </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> c</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1">Now, let&#x27;s see what happens when you call <span class="chakra-text css-167an7n">divAddNoOverflow(4, 0xff, 3)</span>.
You might expect it to return 4, i.e. <span class="chakra-text css-167an7n">8 / ((255 + 3) % 256)</span>.
After all, <span class="chakra-text css-167an7n">z</span> is based on <span class="chakra-text css-167an7n">uint8</span> and an unchecked addition of 3 to 255 should wrap around and give you 2.
<span class="chakra-text css-167an7n">8 / 2</span> is 4.
This is not what happens.
The actual result is zero.</p>
<p class="chakra-text css-1t48wb1">Note that local variables take up whole stack slots and all calculations in inline assembly are
performed on 256-bit numbers.
The result of <span class="chakra-text css-167an7n">add(0xff, 3)</span> is actually <span class="chakra-text css-167an7n">0x0102</span> and <span class="chakra-text css-167an7n">yoloAdd()</span> does not clear the higher bits.
<span class="chakra-text css-167an7n">yoloDiv()</span> then receives that value as <span class="chakra-text css-167an7n">y</span>, and again does not clear the higher bits.
This results in an integer division by 258 rather than by 2.</p>
<p class="chakra-text css-1t48wb1">The problem can be avoided with manual cleanup.
The code would work as designed if <span class="chakra-text css-167an7n">add(x, y)</span> was replaced with</p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#DD4A68">and</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0xff</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">and</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0xff</span><span class="token" style="color:#999">,</span><span> x</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">and</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0xff</span><span class="token" style="color:#999">,</span><span> y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1">and <span class="chakra-text css-167an7n">div(x, y)</span> with</p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#DD4A68">and</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0xff</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">div</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">and</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0xff</span><span class="token" style="color:#999">,</span><span> x</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">and</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">0xff</span><span class="token" style="color:#999">,</span><span> y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span>
</span></code></pre></pre></div>
<h4 class="chakra-heading css-w2m4nu">Examples</h4>
<style data-emotion="css 1t9o39q">.css-1t9o39q{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-fontWeights-bold);font-size:var(--chakra-fontSizes-3xl);line-height:1.33;text-wrap:balance;color:var(--chakra-colors-text);}@media screen and (min-width: 48em){.css-1t9o39q{font-size:var(--chakra-fontSizes-4xl);line-height:1.2;}}</style><h5 class="chakra-heading css-1t9o39q">Unchecked Counter</h5>
<p class="chakra-text css-1t48wb1">This example shows how operators can be used to bypass the checked arithmetic for types
specifically defined for cases where those checks are superfluous:</p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">pragma</span><span> </span><span class="token" style="color:#07a">solidity</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">^</span><span class="token version" style="color:#905">0.8.19</span><span class="token" style="color:#999">;</span><span>
</span>
<span>type UncheckedCounter </span><span class="token" style="color:#07a">is</span><span> </span><span class="token" style="color:#690">uint</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>add </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span class="token" style="color:#999">,</span><span> lt </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> UncheckedCounter global</span><span class="token" style="color:#999">;</span><span>
</span>
<span>UncheckedCounter </span><span class="token" style="color:#07a">constant</span><span> ONE </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> UncheckedCounter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">1</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>UncheckedCounter x</span><span class="token" style="color:#999">,</span><span> UncheckedCounter y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>UncheckedCounter</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    unchecked </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> UncheckedCounter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>
</span><span>            UncheckedCounter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span>
</span><span>            UncheckedCounter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span>
</span><span>        </span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">lt</span><span class="token" style="color:#999">(</span><span>UncheckedCounter x</span><span class="token" style="color:#999">,</span><span> UncheckedCounter y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">bool</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">return</span><span> UncheckedCounter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span> UncheckedCounter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">contract</span><span> </span><span class="token" style="color:#DD4A68">C</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#690">uint</span><span> internalCounter </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#905">12</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">testCounter</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">uint</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">for</span><span> </span><span class="token" style="color:#999">(</span><span>
</span><span>            UncheckedCounter i </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> UncheckedCounter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">12</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>            i </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;</span><span> UncheckedCounter</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">20</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>            i </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> i </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> ONE
</span><span>        </span><span class="token" style="color:#999">)</span><span>
</span><span>            </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">++</span><span>internalCounter</span><span class="token" style="color:#999">;</span><span>
</span>
<span>        </span><span class="token" style="color:#07a">return</span><span> internalCounter</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<h5 class="chakra-heading css-1t9o39q">A More Complex Abstract Example</h5>
<p class="chakra-text css-1t48wb1">This is a more complex example that shows multiple aspects of user-defined operators.
The exact calculations it performs do not matter, the point is to show the syntax in a larger context.</p>
<p class="chakra-text css-1t48wb1"><span class="chakra-text css-167an7n">redBlueScore.sol</span></p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">pragma</span><span> </span><span class="token" style="color:#07a">solidity</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">^</span><span class="token version" style="color:#905">0.8.19</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">import</span><span> </span><span class="token" style="color:#999">{</span><span>Red</span><span class="token" style="color:#999">,</span><span> Blue</span><span class="token" style="color:#999">,</span><span> Score</span><span class="token" style="color:#999">,</span><span> RED_LIMIT</span><span class="token" style="color:#999">,</span><span> BLUE_LIMIT</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">from</span><span> </span><span class="token" style="color:#690">&quot;./types.sol&quot;</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">contract</span><span> </span><span class="token" style="color:#DD4A68">RedBlueScore</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    Red </span><span class="token" style="color:#07a">public</span><span> redGauge</span><span class="token" style="color:#999">;</span><span>
</span><span>    Blue </span><span class="token" style="color:#07a">public</span><span> blueGauge</span><span class="token" style="color:#999">;</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">voteRed</span><span class="token" style="color:#999">(</span><span>Red value</span><span class="token" style="color:#999">,</span><span> Red base</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">require</span><span class="token" style="color:#999">(</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span>RED_LIMIT </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;=</span><span> value </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">*</span><span> base </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&amp;&amp;</span><span> value </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">*</span><span> base </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;=</span><span> RED_LIMIT</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        redGauge </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> redGauge </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> value </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">*</span><span> base</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">exp</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">3</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">voteBlue</span><span class="token" style="color:#999">(</span><span>Blue value</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">require</span><span class="token" style="color:#999">(</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span>BLUE_LIMIT </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;=</span><span> value </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&amp;&amp;</span><span> value </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;=</span><span> BLUE_LIMIT</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>        blueGauge </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> blueGauge </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> value </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span> Blue</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">100</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">calculateScore</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">public</span><span> </span><span class="token" style="color:#07a">view</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Score</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span>
</span><span>            redGauge</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">toScore</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span> RED_LIMIT</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">toScore</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span>
</span><span>            blueGauge</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">toScore</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span> BLUE_LIMIT</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">toScore</span><span class="token" style="color:#999">(</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1"><span class="chakra-text css-167an7n">types.sol</span></p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">pragma</span><span> </span><span class="token" style="color:#07a">solidity</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">^</span><span class="token version" style="color:#905">0.8.19</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">import</span><span> </span><span class="token" style="color:#690">&quot;./operators.sol&quot;</span><span> </span><span class="token" style="color:#07a">as</span><span> op</span><span class="token" style="color:#999">;</span><span>
</span>
<span>type Red </span><span class="token" style="color:#07a">is</span><span> </span><span class="token" style="color:#690">int</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>op</span><span class="token" style="color:#999">.</span><span>RedLib</span><span class="token" style="color:#999">.</span><span>toScore</span><span class="token" style="color:#999">,</span><span> op</span><span class="token" style="color:#999">.</span><span>RedLib</span><span class="token" style="color:#999">.</span><span>exp</span><span class="token" style="color:#999">,</span><span> op</span><span class="token" style="color:#999">.</span><span>addRed </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span class="token" style="color:#999">,</span><span> op</span><span class="token" style="color:#999">.</span><span>mulRed </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">*</span><span class="token" style="color:#999">,</span><span> op</span><span class="token" style="color:#999">.</span><span>unsubRed </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Red global</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>op</span><span class="token" style="color:#999">.</span><span>lteRed </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;=</span><span class="token" style="color:#999">,</span><span> op</span><span class="token" style="color:#999">.</span><span>gtRed </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Red global</span><span class="token" style="color:#999">;</span><span>
</span>
<span>type Blue </span><span class="token" style="color:#07a">is</span><span> </span><span class="token" style="color:#690">int</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    op</span><span class="token" style="color:#999">.</span><span>addBlue </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span class="token" style="color:#999">,</span><span>
</span><span>    op</span><span class="token" style="color:#999">.</span><span>unsubBlue </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span class="token" style="color:#999">,</span><span>
</span><span>    op</span><span class="token" style="color:#999">.</span><span>subBlue </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span class="token" style="color:#999">,</span><span>
</span><span>    op</span><span class="token" style="color:#999">.</span><span>BlueLib</span><span class="token" style="color:#999">.</span><span>toScore</span><span class="token" style="color:#999">,</span><span>
</span><span>    op</span><span class="token" style="color:#999">.</span><span>lteBlue </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;=</span><span class="token" style="color:#999">,</span><span>
</span><span>    op</span><span class="token" style="color:#999">.</span><span>gtBlue </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&gt;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Blue global</span><span class="token" style="color:#999">;</span><span>
</span>
<span>type Score </span><span class="token" style="color:#07a">is</span><span> </span><span class="token" style="color:#690">int128</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>op</span><span class="token" style="color:#999">.</span><span>addScore </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Score global</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>op</span><span class="token" style="color:#999">.</span><span>subScore </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Score global</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>op</span><span class="token" style="color:#999">.</span><span>divScore </span><span class="token" style="color:#07a">as</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Score global</span><span class="token" style="color:#999">;</span><span>
</span>
<span>Red </span><span class="token" style="color:#07a">constant</span><span> RED_LIMIT </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">10</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>Blue </span><span class="token" style="color:#07a">constant</span><span> BLUE_LIMIT </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> Blue</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">20</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1"><span class="chakra-text css-167an7n">operators.sol</span></p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">pragma</span><span> </span><span class="token" style="color:#07a">solidity</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">^</span><span class="token version" style="color:#905">0.8.19</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">import</span><span> </span><span class="token" style="color:#999">{</span><span>Red</span><span class="token" style="color:#999">,</span><span> Blue</span><span class="token" style="color:#999">,</span><span> Score</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">from</span><span> </span><span class="token" style="color:#690">&quot;./types.sol&quot;</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">library</span><span> </span><span class="token" style="color:#DD4A68">RedLib</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">toScore</span><span class="token" style="color:#999">(</span><span>Red x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">internal</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Score</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">int128</span><span class="token" style="color:#999">(</span><span>Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">10</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">exp</span><span class="token" style="color:#999">(</span><span>Red x</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">uint</span><span> y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">internal</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Red</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">**</span><span> y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">library</span><span> </span><span class="token" style="color:#DD4A68">BlueLib</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">toScore</span><span class="token" style="color:#999">(</span><span>Blue x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">internal</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Score</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">int128</span><span class="token" style="color:#999">(</span><span>Blue</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span> Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#905">20</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span>
<span>    </span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>Blue x</span><span class="token" style="color:#999">,</span><span> Blue y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">external</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Blue</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>        </span><span class="token" style="color:#07a">return</span><span> Blue</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Blue</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> Blue</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span>    </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">using</span><span> </span><span class="token" style="color:#999">{</span><span>BlueLib</span><span class="token" style="color:#999">.</span><span>add</span><span class="token" style="color:#999">}</span><span> </span><span class="token" style="color:#07a">for</span><span> Blue</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">addRed</span><span class="token" style="color:#999">(</span><span>Red x</span><span class="token" style="color:#999">,</span><span> Red y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Red</span><span class="token" style="color:#999">)</span><span>  </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">mulRed</span><span class="token" style="color:#999">(</span><span>Red x</span><span class="token" style="color:#999">,</span><span> Red y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Red</span><span class="token" style="color:#999">)</span><span>  </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">*</span><span> Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">unsubRed</span><span class="token" style="color:#999">(</span><span>Red x</span><span class="token" style="color:#999">)</span><span>      </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Red</span><span class="token" style="color:#999">)</span><span>  </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span>Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">lteRed</span><span class="token" style="color:#999">(</span><span>Red x</span><span class="token" style="color:#999">,</span><span> Red y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">bool</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;=</span><span> Red</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">gtRed</span><span class="token" style="color:#999">(</span><span>Red x</span><span class="token" style="color:#999">,</span><span> Red y</span><span class="token" style="color:#999">)</span><span>  </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">bool</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!</span><span class="token" style="color:#999">(</span><span>x </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;=</span><span> y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">addBlue</span><span class="token" style="color:#999">(</span><span>Blue x</span><span class="token" style="color:#999">,</span><span> Blue y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Blue</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> x</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">unsubBlue</span><span class="token" style="color:#999">(</span><span>Blue x</span><span class="token" style="color:#999">)</span><span>       </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Blue</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> Blue</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span>Blue</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">subBlue</span><span class="token" style="color:#999">(</span><span>Blue x</span><span class="token" style="color:#999">,</span><span> Blue y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Blue</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> x </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span>y</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">lteBlue</span><span class="token" style="color:#999">(</span><span>Blue x</span><span class="token" style="color:#999">,</span><span> Blue y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">bool</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> Blue</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;=</span><span> Blue</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">gtBlue</span><span class="token" style="color:#999">(</span><span>Blue x</span><span class="token" style="color:#999">,</span><span> Blue y</span><span class="token" style="color:#999">)</span><span>  </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">bool</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">!</span><span class="token" style="color:#999">(</span><span>x </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">&lt;=</span><span> y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">addScore</span><span class="token" style="color:#999">(</span><span>Score x</span><span class="token" style="color:#999">,</span><span> Score y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Score</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">subScore</span><span class="token" style="color:#999">(</span><span>Score x</span><span class="token" style="color:#999">,</span><span> Score y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Score</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">-</span><span> Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">divScore</span><span class="token" style="color:#999">(</span><span>Score x</span><span class="token" style="color:#999">,</span><span> Score y</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>Score</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#07a">return</span><span> Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">wrap</span><span class="token" style="color:#999">(</span><span>Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span> Score</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">unwrap</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span> </span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<h3 class="chakra-heading css-xeg9ae">AST Changes</h3>
<p class="chakra-text css-1t48wb1">The new feature introduces two new attributes to the Abstract Syntax Tree (AST) produced by the compiler:</p>
<ol role="list" class="css-13a5a39"><li class="css-cvpopp"><span class="chakra-text css-167an7n">functionList</span> on <span class="chakra-text css-167an7n">UsingForDirective</span> nodes can now contain operator entries of the following structure:<!-- -->
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-json" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token" style="color:#905">&quot;operator&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#690">&quot;+&quot;</span><span class="token" style="color:#999">,</span><span>
</span><span>  </span><span class="token" style="color:#905">&quot;definition&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:slategray">/* function */</span><span>
</span><span>  </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<!-- -->in addition to the current entries for functions that are structured as follows:<!-- -->
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-json" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#999">{</span><span>
</span><span>  </span><span class="token" style="color:#905">&quot;function&quot;</span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">:</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:slategray">/* function */</span><span>
</span><span>  </span><span class="token" style="color:#999">}</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
</li><li class="css-cvpopp"><span class="chakra-text css-167an7n">BinaryOperation</span> and <span class="chakra-text css-167an7n">UnaryOperation</span> nodes may now have a <span class="chakra-text css-167an7n">function</span> attribute.
If present, the attribute indicates that the operation is actually an invocation of a user-defined
operator and specifies the ID of the function used to define it.</li></ol>
<p class="chakra-text css-1t48wb1">This effectively introduces a new way to perform a function call not represented by a <span class="chakra-text css-167an7n">FunctionCall</span> node.
It will affect any tool that needs to detect and follow function calls, for example, to build a
control flow graph.</p>
<h3 class="chakra-heading css-xeg9ae">Design Rationale</h3>
<h4 class="chakra-heading css-w2m4nu">Why Does Solidity Need User-Defined Operators?</h4>
<p class="chakra-text css-1t48wb1">The support for user-defined value types in Solidity cannot be considered complete without more natural
ways to operate on them.
The ability to use operators was envisioned from the beginning, and the main reason it was not provided
immediately was the uncertainty regarding interactions with other features we plan to introduce.
We decided that it was best to release the feature in a minimal usable state and extend it over time,
taking into account user feedback.</p>
<p class="chakra-text css-1t48wb1">UDVTs in general were meant to fulfill two needs:</p>
<ol role="list" class="css-13a5a39"><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">More type-safety when performing operations on values of the same underlying value type that express
conceptually different things.
For example quantities of different dimensions could both be stored as <span class="chakra-text css-167an7n">uint</span> but adding them without
an explicit conversion is a mistake that can only be prevented if the compiler knows that they
are values of different kinds.</p>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">The ability to define new types using value types as the underlying representation.
The best example of this are fixed-point types.</p>
<p class="chakra-text css-1t48wb1">Fixed-point types were originally planned to be an integral part of the language, and the
partially implemented <a class="chakra-link css-3ea0e8" href="https://docs.soliditylang.org/en/latest/types.html?color=light#fixed-point-numbers"><span class="chakra-text css-167an7n">ufixed</span> and <span class="chakra-text css-167an7n">fixed</span></a>
types are the vestiges of that old design.
While trying to agree on the final design for the feature, however, we realized that no implementation
will be a good enough trade-off for most situations and cannot become a suitable default choice.
We decided to leave the choice up to library authors and instead focus on providing primitives
necessary to build their own fixed-point types that feel like native types.
User-defined operators are a step towards that goal.</p>
</li></ol>
<h4 class="chakra-heading css-w2m4nu">Will User-Defined Operators Make Auditing Harder?</h4>
<p class="chakra-text css-1t48wb1">In the feedback we received so far one of the most common concerns is the effect of the feature on contract
auditing and potential to mask malicious code.
We want to address these concerns here.</p>
<p class="chakra-text css-1t48wb1">First of all, any new syntax increases the complexity of the language and has some potential to make code more obscure
and harder to understand when abused.
It cannot be completely avoided and is always a trade-off between all the good and bad ways it can be used.
We think that improving the ergonomics of UDVTs is important enough that it outweighs any of the downsides we considered.</p>
<p class="chakra-text css-1t48wb1">The readability benefits provided by operators cannot be overstated.
Code containing even relatively simple expressions can be hard to understand at a glance when many function calls are involved:</p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">equals</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">mul</span><span class="token" style="color:#999">(</span><span>a</span><span class="token" style="color:#999">,</span><span> x</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">mul</span><span class="token" style="color:#999">(</span><span>b</span><span class="token" style="color:#999">,</span><span> y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">div</span><span class="token" style="color:#999">(</span><span>c</span><span class="token" style="color:#999">,</span><span> z</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">mod</span><span class="token" style="color:#999">(</span><span>d</span><span class="token" style="color:#999">,</span><span> w</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">return</span><span> </span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span class="token" style="color:#DD4A68">div</span><span class="token" style="color:#999">(</span><span>c</span><span class="token" style="color:#999">,</span><span> z</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#DD4A68">mod</span><span class="token" style="color:#999">(</span><span>d</span><span class="token" style="color:#999">,</span><span> w</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1">Chaining attached functions somewhat helps by placing the operation name between the arguments (similar to an infix operator):</p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>a</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">mul</span><span class="token" style="color:#999">(</span><span>x</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>b</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">mul</span><span class="token" style="color:#999">(</span><span>y</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">equals</span><span class="token" style="color:#999">(</span><span>c</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">div</span><span class="token" style="color:#999">(</span><span>z</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>d</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">mul</span><span class="token" style="color:#999">(</span><span>w</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">return</span><span> c</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">div</span><span class="token" style="color:#999">(</span><span>z</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">add</span><span class="token" style="color:#999">(</span><span>d</span><span class="token" style="color:#999">.</span><span class="token" style="color:#DD4A68">mod</span><span class="token" style="color:#999">(</span><span>w</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">)</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1">It is, however, still a far cry from the clean, concise notation that can be achieved with the use of operators:</p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#07a">if</span><span> </span><span class="token" style="color:#999">(</span><span>a </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">*</span><span> x </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> b </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">*</span><span> y </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">==</span><span> c </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span> z </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> d </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">%</span><span> w</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span>
</span><span>    </span><span class="token" style="color:#07a">return</span><span> c </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">/</span><span> z </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">+</span><span> d </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">%</span><span> w</span><span class="token" style="color:#999">;</span><span>
</span><span></span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1">The last example is how we would prefer real code to look like.
By the way, did you spot the mistake in the second example?</p>
<p class="chakra-text css-1t48wb1">It is also essential to realize the actual scope of the feature.
You may imagine an elaborate system from languages like C++, with complicated rules and many corner cases.
As implemented now the feature is deliberately very limited.
We tried both to limit surprises and to avoid prematurely adding support for cases that we have not carefully thought out.</p>
<p class="chakra-text css-1t48wb1">In the current implementation, it is not possible to:</p>
<ol role="list" class="css-13a5a39"><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Have operators on types other than UDVTs.</p>
<style data-emotion="css 347cfg">.css-347cfg{list-style-type:circle;-webkit-margin-start:1em;margin-inline-start:1em;padding-left:var(--chakra-space-4);}.css-347cfg>*:not(style)~*:not(style){margin-top:var(--chakra-space-2);}</style><ul role="list" class="css-347cfg"><li class="css-cvpopp">User-defined operators on <a class="chakra-link css-3ea0e8" href="https://docs.soliditylang.org/en/latest/types.html?color=light#reference-types">reference types</a>
like structs or arrays are not allowed.</li><li class="css-cvpopp">It is not possible to define them on built-in value types, function types or enums.</li><li class="css-cvpopp">You cannot define them to unnamed types using the type wildcard (<span class="chakra-text css-167an7n">*</span>).</li></ul>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Have operators that are not <span class="chakra-text css-167an7n">pure</span>.
Operators cannot modify storage.
They can, at most, make pure external calls.</p>
<p class="chakra-text css-1t48wb1">The worst that is technically possible with tricks is for them to modify memory (only through inline assembly)
or make staticcalls (through interfaces that do not match deployed code).</p>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Have operators on mixed types.
Parameter and return value types of operators must be the same.
Also, no implicit conversions are possible, so it is very simple to determine if a particular operation
will invoke a user-define operator or a built-in one (just look at the type).</p>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Redefine operators.
You cannot replace any of the built-in operators with a custom definition.
For user-defined operators, only one definition can be provided.</p>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Bind operators to contract functions.
This also means that operator definitions cannot be inherited, virtual, or remain unimplemented.</p>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Bind operators to overloaded functions.</p>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Use built-in functions to define operators.
You cannot e.g. bind an operator directly to <span class="chakra-text css-167an7n">keccak256()</span>.</p>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Change the precedence or associativity of an operator.</p>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Define any of the operators with more complex semantics.
You cannot define:</p>
<ul role="list" class="css-347cfg"><li class="css-cvpopp"><span class="chakra-text css-167an7n">&amp;&amp;</span> and <span class="chakra-text css-167an7n">||</span> due to their short-circuiting behavior.</li><li class="css-cvpopp"><span class="chakra-text css-167an7n">++</span> and <span class="chakra-text css-167an7n">--</span> because they modify their argument and also have separate prefix and postfix variants with different semantics.</li><li class="css-cvpopp"><span class="chakra-text css-167an7n">+=</span>, <span class="chakra-text css-167an7n">-=</span>, <span class="chakra-text css-167an7n">^=</span>, <span class="chakra-text css-167an7n">*=</span>, <span class="chakra-text css-167an7n">/=</span>, <span class="chakra-text css-167an7n">%=</span>, <span class="chakra-text css-167an7n">&amp;=</span>, <span class="chakra-text css-167an7n">|=</span>, <span class="chakra-text css-167an7n">^=</span>, <span class="chakra-text css-167an7n">&lt;&lt;=</span>, <span class="chakra-text css-167an7n">&gt;&gt;=</span> because they modify their argument.</li><li class="css-cvpopp"><span class="chakra-text css-167an7n">=</span>, <span class="chakra-text css-167an7n">()</span>, <span class="chakra-text css-167an7n">?:</span>, and <span class="chakra-text css-167an7n">.</span> because they are built-in for all types.</li><li class="css-cvpopp"><span class="chakra-text css-167an7n">delete</span>, <span class="chakra-text css-167an7n">new</span>, and <span class="chakra-text css-167an7n">[]</span> because they are not usable with UDVTs.</li></ul>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Define custom operators that do not exist in the language, like <span class="chakra-text css-167an7n">===</span> or unary <span class="chakra-text css-167an7n">+</span>.</p>
</li><li class="css-cvpopp">
<p class="chakra-text css-1t48wb1">Bind operators in bulk or accidentally.
The <span class="chakra-text css-167an7n">using L for T</span> syntax for attaching a whole library to a type does not cover operators.
Operators must always be bound explicitly.</p>
</li></ol>
<p class="chakra-text css-1t48wb1">In addition to these restrictions, we decided to limit them even more in response to feedback we received before releasing Solidity 0.8.18.
This means you also cannot:</p>
<ol role="list" class="css-13a5a39"><li class="css-cvpopp">Use library functions to define operators.
This excludes external, public, and private functions.
It is also now impossible to apply modifiers to operators because free functions cannot have them.</li><li class="css-cvpopp">Have non-global operators, which has several consequences:<!-- -->
<ul role="list" class="css-347cfg"><li class="css-cvpopp">Operators can only be bound in the file that also defines the type.
They are available wherever the type is available and cannot have different definitions in different scopes.</li><li class="css-cvpopp">Local bindings at contract level are not possible (i.e. inside contracts and libraries).
This also makes it impossible to define operators for local types that are defined inside contracts or libraries.</li></ul>
</li><li class="css-cvpopp">Define <span class="chakra-text css-167an7n">!</span>, <span class="chakra-text css-167an7n">&lt;&lt;</span>, <span class="chakra-text css-167an7n">&gt;&gt;</span> and <span class="chakra-text css-167an7n">**</span>.</li></ol>
<p class="chakra-text css-1t48wb1">We may lift <em class="chakra-text css-0">some</em> of these restrictions in the future, but we will consider every case carefully.
Some of them, like the inability to use overloaded functions, stem from pre-existing limitations of the syntax, but
others, like a ban on redefining built-in operators, are very intentional and meant to limit potential misuse.</p>
<p class="chakra-text css-1t48wb1">In the end, any audit must include a careful review of type definitions and functions, and we think
that this will reveal most cases of malicious behavior.
Given the above limitations, bad operators cannot do much more than mislead, which is something that
will come up in the review of the definition.
Weird behavior, like <span class="chakra-text css-167an7n">+</span> that does anything other than perform addition should raise a red flag,
just like a function called <span class="chakra-text css-167an7n">transfer()</span> that does not transfer anything.</p>
<p class="chakra-text css-1t48wb1">Reviewing the invocations of an operator should not pose significant problems either, as long as
the reviewer is aware of the types involved, which is always necessary to understand the expression.
This is not a new thing, since the behavior of the built-in operators has always been affected by operand types.
For example the overflow semantics of integer types depend on the size of the type in question.</p>
<p class="chakra-text css-1t48wb1">Note that user-defined operators cannot alter semantics of the existing code.
For built-in types behavior cannot be altered at all.
For UDVTs any operator must necessarily be user-defined so seeing it is not much different from
seeing a function call.
An operator can have only one definition, the definition must be explicitly bound in the file that
defines the type and cannot be shadowed.
In both cases the name may be misleading and a look at the definition may be necessary.</p>
<p class="chakra-text css-1t48wb1">It is also worth noting that the feature is meant to be predominantly used in reusable libraries providing common types.
In this context, once the library is audited, the concern about operators having misleading or unexpected behavior should be minimal.</p>
<h3 class="chakra-heading css-xeg9ae">The Future of User-Defined Operators and UDVTs</h3>
<p class="chakra-text css-1t48wb1">Now that we know the new feature and its limitations, the question on everyone&#x27;s mind is probably
&quot;Will it stay that way?&quot;.
How will the feature evolve in the short and long term?</p>
<h4 class="chakra-heading css-w2m4nu">Literal Suffixes</h4>
<p class="chakra-text css-1t48wb1">The very next step for UDVTs is the ability to provide custom literals of user-defined value types.
The ease of using literal values in expressions is a big part of what makes a type feel native.
Solidity already provides fractional literals and our intention is to make them usable with custom
fixed-point number implementations.
To achieve that we are going to allow defining suffix functions that return UDVT by converting
literals that are already available in the language:</p>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>type UFixed128x18 </span><span class="token" style="color:#07a">is</span><span> </span><span class="token" style="color:#690">uint128</span><span class="token" style="color:#999">;</span><span>
</span>
<span></span><span class="token" style="color:#07a">function</span><span> </span><span class="token" style="color:#DD4A68">uf</span><span class="token" style="color:#999">(</span><span class="token" style="color:#690">int16</span><span> mantissa</span><span class="token" style="color:#999">,</span><span> </span><span class="token" style="color:#690">uint8</span><span> exponent</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#07a">pure</span><span> suffix </span><span class="token" style="color:#07a">returns</span><span> </span><span class="token" style="color:#999">(</span><span>UFixed128x18</span><span class="token" style="color:#999">)</span><span> </span><span class="token" style="color:#999">{</span><span> </span><span class="token" style="color:#999">.</span><span class="token" style="color:#999">.</span><span class="token" style="color:#999">.</span><span> </span><span class="token" style="color:#999">}</span><span>
</span></code></pre></pre></div>
<div class="chakra-stack css-1uyok63"><pre><pre style="color:black;background:#f5f2f0;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-solidity" style="color:black;background:none;text-shadow:0 1px white;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>UFixed128x18 circumference </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">=</span><span> </span><span class="token" style="color:#905">2</span><span> uf </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">*</span><span> </span><span class="token" style="color:#905">3.14</span><span> uf </span><span class="token" style="color:#9a6e3a;background:hsla(0, 0%, 100%, .5)">*</span><span> radius</span><span class="token" style="color:#999">;</span><span>
</span></code></pre></pre></div>
<p class="chakra-text css-1t48wb1">While the application of a suffix will involve a function call, eventually, with the help of
compile-time evaluation, literal suffixes are going to become as efficient as native literals.</p>
<h4 class="chakra-heading css-w2m4nu">More Operators</h4>
<p class="chakra-text css-1t48wb1">Many operators have been excluded from the initial implementation.
Some of them will very likely be user-definable at some point:</p>
<ol role="list" class="css-13a5a39"><li class="css-cvpopp"><span class="chakra-text css-167an7n">&lt;&lt;</span>, <span class="chakra-text css-167an7n">&gt;&gt;</span> and <span class="chakra-text css-167an7n">**</span> were excluded due to their non-uniform arguments.
For built-in types, the right-hand side is always an unsigned type.</li><li class="css-cvpopp"><span class="chakra-text css-167an7n">!</span> was excluded because we have to decide whether it should return the same type as the argument
or just <span class="chakra-text css-167an7n">bool</span>.
We are leaning towards the latter, but it needs more consideration.</li><li class="css-cvpopp"><span class="chakra-text css-167an7n">++</span> and <span class="chakra-text css-167an7n">--</span> are very convenient, and we want to have them eventually.
They just need to be handled in a special way, and there is more than way to do so.</li><li class="css-cvpopp">Composite assignment operators, such as <span class="chakra-text css-167an7n">+=</span>, will likely be provided automatically
in the future as long as the corresponding arithmetic/bitwise operator is available.
Allowing a direct implementation is currently not possible anyway, because there are no references
to value types in the language.</li></ol>
<p class="chakra-text css-1t48wb1">On the other hand, it is unlikely that we will allow redefining some other operators:</p>
<ol role="list" class="css-13a5a39"><li class="css-cvpopp"><span class="chakra-text css-167an7n">=</span> is already provided by the compiler for all types and it is very unlikely that we will ever allow redefining it.</li></ol>
<h4 class="chakra-heading css-w2m4nu">Operators on Complex Types</h4>
<p class="chakra-text css-1t48wb1">While UDVTs were the primary target, in some cases it may also be reasonable to build a custom type
with a more complex underlying representation, such as a struct or a dynamic array.
The main thing holding us back here are upcoming changes to the type system that are a significant part
of our roadmap for the near future.
To avoid having to introduce breaking changes later, we decided to defer support for such operators until
these changes are behind us.</p>
<h4 class="chakra-heading css-w2m4nu">What Will Not Change?</h4>
<p class="chakra-text css-1t48wb1">Due to concerns about the safety of the feature, there are some key elements that are very unlikely to ever change regarding operators.
Operators will likely always be global and defined at file level with free functions.
It will not be possible to replace built-in opertors or redefine already defined user-defined operators.</p></article><style data-emotion="css 1ay3ec4">.css-1ay3ec4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;gap:var(--chakra-space-4);padding-top:var(--chakra-space-12);padding-bottom:var(--chakra-space-12);}@media screen and (min-width: 30em){.css-1ay3ec4{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:var(--chakra-space-8);}}</style><div class="css-1ay3ec4"><style data-emotion="css mjnkft">.css-mjnkft{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;color:inherit;-webkit-text-decoration:none!important;text-decoration:none!important;width:var(--chakra-sizes-full);box-sizing:border-box;font-weight:var(--chakra-fontWeights-bold);}.css-mjnkft:focus-visible,.css-mjnkft[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}@media screen and (min-width: 30em){.css-mjnkft{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;}}.css-mjnkft:hover,.css-mjnkft[data-hover]{color:var(--chakra-colors-primary);}</style><a class="chakra-link css-mjnkft" data-group="true" href="/blog/2023/03/10/solidity-developer-survey-2022-results"><style data-emotion="css 1xq4k5x">.css-1xq4k5x{color:var(--chakra-colors-text);background:var(--chakra-colors-transparent);border:var(--chakra-borders-2px);border-color:var(--chakra-colors-border);font-size:var(--chakra-fontSizes-md);border-radius:var(--chakra-radii-none);-webkit-padding-start:var(--chakra-space-6);padding-inline-start:var(--chakra-space-6);-webkit-padding-end:var(--chakra-space-6);padding-inline-end:var(--chakra-space-6);padding-top:var(--chakra-space-2);padding-bottom:var(--chakra-space-2);text-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:var(--chakra-sizes-full);}[role=group]:hover .css-1xq4k5x,[role=group][data-hover] .css-1xq4k5x,[data-group]:hover .css-1xq4k5x,[data-group][data-hover] .css-1xq4k5x,.group:hover .css-1xq4k5x,.group[data-hover] .css-1xq4k5x{background:var(--chakra-colors-mode);color:var(--chakra-colors-primary);-webkit-text-decoration:none;text-decoration:none;border-color:var(--chakra-colors-primary);}@media screen and (min-width: 30em){.css-1xq4k5x{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;}}</style><div class="css-1xq4k5x"><style data-emotion="css qgraaf">.css-qgraaf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-qgraaf"><style data-emotion="css 1ctuces">.css-1ctuces{width:1em;height:1em;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;-webkit-margin-end:var(--chakra-space-2);margin-inline-end:var(--chakra-space-2);-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg);}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1ctuces" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M8 5v14l11-7z"></path></svg><style data-emotion="css 1ok78dc">.css-1ok78dc{font-family:var(--chakra-fonts-heading);text-transform:uppercase;}</style><p class="chakra-text css-1ok78dc">Previous post</p></div></div></a><a class="chakra-link css-mjnkft" data-group="true" href="/blog/2023/02/22/solidity-0.8.19-release-announcement"><div class="css-1xq4k5x"><div class="css-qgraaf"><span class="chakra-text css-1ok78dc">Next post</span><style data-emotion="css 1kbxt31">.css-1kbxt31{width:1em;height:1em;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentColor;-webkit-margin-start:var(--chakra-space-2);margin-inline-start:var(--chakra-space-2);}</style><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" focusable="false" class="chakra-icon css-1kbxt31" height="16" width="16" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M8 5v14l11-7z"></path></svg></div></div></a></div></main><style data-emotion="css yqkimu">.css-yqkimu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:start;-webkit-box-align:start;-ms-flex-align:start;align-items:start;padding-bottom:var(--chakra-space-24);padding-top:var(--chakra-space-12);-webkit-padding-start:var(--chakra-space-4);padding-inline-start:var(--chakra-space-4);-webkit-padding-end:var(--chakra-space-4);padding-inline-end:var(--chakra-space-4);gap:var(--chakra-space-10);}@media screen and (min-width: 48em){.css-yqkimu{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-padding-start:var(--chakra-space-8);padding-inline-start:var(--chakra-space-8);-webkit-padding-end:var(--chakra-space-8);padding-inline-end:var(--chakra-space-8);}}</style><footer class="css-yqkimu"><style data-emotion="css 1p5lkn8">.css-1p5lkn8{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:start;-webkit-box-align:start;-ms-flex-align:start;align-items:start;gap:var(--chakra-space-1);}@media screen and (min-width: 48em){.css-1p5lkn8{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}}</style><div class="css-1p5lkn8"><style data-emotion="css 1svhtxd">.css-1svhtxd{font-family:var(--chakra-fonts-mono);font-size:var(--chakra-fontSizes-md);color:var(--chakra-colors-secondary);font-weight:var(--chakra-fontWeights-bold);}</style><p class="chakra-text css-1svhtxd">Get involved</p><style data-emotion="css f1r7lu">.css-f1r7lu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-column-gap:var(--chakra-space-8);column-gap:var(--chakra-space-8);-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}@media screen and (min-width: 48em){.css-f1r7lu{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><div class="css-f1r7lu"><style data-emotion="css f9g02g">.css-f9g02g{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;color:inherit;-webkit-text-decoration:none;text-decoration:none;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;}.css-f9g02g:focus-visible,.css-f9g02g[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-f9g02g:hover,.css-f9g02g[data-hover]{color:var(--chakra-colors-primary);}</style><a target="_blank" rel="noopener" class="chakra-link css-f9g02g" href="https://github.com/ethereum/solidity"><style data-emotion="css 1k9efnl">.css-1k9efnl{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:var(--chakra-space-2);}</style><div class="css-1k9efnl"><style data-emotion="css 1r9fqls">.css-1r9fqls{border-radius:var(--chakra-radii-base);padding-top:var(--chakra-space-2);padding-bottom:var(--chakra-space-2);}</style><div class="css-1r9fqls"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></div><style data-emotion="css i3jkqk">.css-i3jkqk{font-size:var(--chakra-fontSizes-lg);}</style><p class="chakra-text css-i3jkqk">GitHub</p></div></a><a target="_blank" rel="noopener" class="chakra-link css-f9g02g" href="https://twitter.com/solidity_lang"><div class="css-1k9efnl"><div class="css-1r9fqls"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></div><p class="chakra-text css-i3jkqk">Twitter</p></div></a><a target="_blank" rel="noopener" class="chakra-link css-f9g02g" href="https://fosstodon.org/@solidity"><div class="css-1k9efnl"><div class="css-1r9fqls"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg></div><p class="chakra-text css-i3jkqk">Mastodon</p></div></a><a target="_blank" rel="noopener" class="chakra-link css-f9g02g" href="https://matrix.to/#/#ethereum_solidity:gitter.im"><div class="css-1k9efnl"><div class="css-1r9fqls"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M.632.55v22.9H2.28V24H0V0h2.28v.55zm7.043 7.26v1.157h.033c.309-.443.683-.784 1.117-1.024.433-.245.936-.365 1.5-.365.54 0 1.033.107 1.481.314.448.208.785.582 1.02 1.108.254-.374.6-.706 1.034-.992.434-.287.95-.43 1.546-.43.453 0 .872.056 1.26.167.388.11.716.286.993.53.276.245.489.559.646.951.152.392.23.863.23 1.417v5.728h-2.349V11.52c0-.286-.01-.559-.032-.812a1.755 1.755 0 0 0-.18-.66 1.106 1.106 0 0 0-.438-.448c-.194-.11-.457-.166-.785-.166-.332 0-.6.064-.803.189a1.38 1.38 0 0 0-.48.499 1.946 1.946 0 0 0-.231.696 5.56 5.56 0 0 0-.06.785v4.768h-2.35v-4.8c0-.254-.004-.503-.018-.752a2.074 2.074 0 0 0-.143-.688 1.052 1.052 0 0 0-.415-.503c-.194-.125-.476-.19-.854-.19-.111 0-.259.024-.439.074-.18.051-.36.143-.53.282-.171.138-.319.337-.439.595-.12.259-.18.6-.18 1.02v4.966H5.46V7.81zm15.693 15.64V.55H21.72V0H24v24h-2.28v-.55z"></path></svg></div><p class="chakra-text css-i3jkqk">Matrix</p></div></a><a target="_blank" rel="noopener" class="chakra-link css-f9g02g" href="https://gitter.im/ethereum/solidity"><div class="css-1k9efnl"><div class="css-1r9fqls"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="18" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"></path></svg></div><p class="chakra-text css-i3jkqk">Gitter</p></div></a></div></div><style data-emotion="css 17xejub">.css-17xejub{-webkit-flex:1;-ms-flex:1;flex:1;justify-self:stretch;-webkit-align-self:stretch;-ms-flex-item-align:stretch;align-self:stretch;}</style><div class="css-17xejub"></div><div class="css-1p5lkn8"><p class="chakra-text css-1svhtxd">Discover more</p><style data-emotion="css 23oyzj">.css-23oyzj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}@media screen and (min-width: 48em){.css-23oyzj{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><div class="css-23oyzj"><style data-emotion="css 1yv37uh">.css-1yv37uh{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;color:inherit;-webkit-text-decoration:none;text-decoration:none;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;padding-top:var(--chakra-space-1);padding-bottom:var(--chakra-space-1);-webkit-padding-start:var(--chakra-space-2);padding-inline-start:var(--chakra-space-2);-webkit-padding-end:var(--chakra-space-2);padding-inline-end:var(--chakra-space-2);}.css-1yv37uh:focus-visible,.css-1yv37uh[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-1yv37uh:hover,.css-1yv37uh[data-hover]{color:var(--chakra-colors-primary);}</style><a class="chakra-link css-1yv37uh" href="/blog">Blog</a><a class="chakra-link css-1yv37uh" href="https://docs.soliditylang.org/?color=light">Documentation</a><a class="chakra-link css-1yv37uh" href="/use-cases">Use cases</a><a class="chakra-link css-1yv37uh" href="https://docs.soliditylang.org/en/latest/contributing.html?color=light">Contribute</a><a class="chakra-link css-1yv37uh" href="/about">About</a><style data-emotion="css 1u8jhzj">.css-1u8jhzj{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;color:inherit;-webkit-text-decoration:none;text-decoration:none;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;padding-top:var(--chakra-space-1);padding-bottom:var(--chakra-space-1);-webkit-padding-start:var(--chakra-space-2);padding-inline-start:var(--chakra-space-2);-webkit-padding-end:var(--chakra-space-2);padding-inline-end:var(--chakra-space-2);}.css-1u8jhzj:focus-visible,.css-1u8jhzj[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-1u8jhzj::after{content:" ↗";white-space:nowrap;}.css-1u8jhzj:hover,.css-1u8jhzj[data-hover]{color:var(--chakra-colors-primary);}</style><a target="_blank" rel="noopener" class="chakra-link css-1u8jhzj" href="https://forum.soliditylang.org/">Forum</a></div></div><style data-emotion="css gacqr9">.css-gacqr9{font-size:var(--chakra-fontSizes-lg);text-align:center;}</style><p class="chakra-text css-gacqr9">2023 Solidity Team •<!-- --> <style data-emotion="css 2gggbp">.css-2gggbp{transition-property:var(--chakra-transition-property-common);transition-duration:var(--chakra-transition-duration-fast);transition-timing-function:var(--chakra-transition-easing-ease-out);cursor:pointer;outline:2px solid transparent;outline-offset:2px;color:inherit;-webkit-text-decoration:underline;text-decoration:underline;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;}.css-2gggbp:focus-visible,.css-2gggbp[data-focus-visible]{box-shadow:var(--chakra-shadows-outline);}.css-2gggbp::after{content:" ↗";white-space:nowrap;}.css-2gggbp:hover,.css-2gggbp[data-hover]{color:var(--chakra-colors-primary);}</style><a target="_blank" rel="noopener" class="chakra-link css-2gggbp" href="https://github.com/ethereum/solidity/blob/develop/CODE_OF_CONDUCT.md">Code of Conduct</a></p></footer></div><span></span><span id="__chakra_env" hidden=""></span></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"layout":"post","published":true,"title":"Feature Deep-Dive: User-Defined Operators","date":"2023-02-22","author":"Kamil Śliwak, Matheus Aguiar","category":"Explainers"},"content":"\nThe highlight of [Solidity 0.8.19](https://github.com/ethereum/solidity/releases/tag/v0.8.19) release\nis the support for defining _operators_ on [user-defined value types](https://docs.soliditylang.org/en/latest/types.html#user-defined-value-types) (UDVTs).\n\nIf you have not been keeping up with recent features, UDVTs are a new class of types introduced in Solidity 0.8.8.\nThey provide an abstraction over an elementary value type that results in a completely new type.\nThis is similar to creating an alias, but the new type is distinct from the underlying value type\nand all other UDVTs derived from that underlying type.\nThe ability to use operators is meant to bring the UDVTs closer to being as natural to use as the\nbuilt-in types and promote the use of type-safe interfaces.\nBelow, we are going to take a closer look into the details of this new mechanism.\n\n### A Quick Refresher\n\nBefore we get into the details of the new feature and how it affects the language, it may be a good\nidea to first go over the two existing features that it builds upon: built-in operators and `using for`.\n\n#### Built-in Operators\n\nSolidity, like the vast majority of programming languages,\n[offers a set of operators](https://docs.soliditylang.org/en/latest/types.html#operators) as syntactic sugar\nover common arithmetical and logical functions.\nThe difference between operators and functions is purely syntactical, and the decision\nto choose one over the other is to a large extent a matter of readability.\nThe use of operators makes expressions more concise, which is helpful as long as they are well\nunderstood by the reader.\nWhat is included in that set varies widely from language to language.\n\nHere is the full list for Solidity:\n\n| Category             | Operators                                                           |\n| -------------------- | ------------------------------------------------------------------- |\n| Bitwise              | `\u0026`, `\\|`, `^`, `\u003c\u003c`, `\u003e\u003e`, `~`                                     |\n| Arithmetic           | `+`, `-`, `*`, `/`, `%`, `**`                                       |\n| Comparison           | `==`, `!=`, `\u003c`, `\u003c=`, `\u003e`, `\u003e=`                                    |\n| Boolean              | `!`, `\u0026\u0026`, `\\|\\|`                                                   |\n| Increment/decrement  | `++`, `--`                                                          |\n| Simple assignment    | `=`                                                                 |\n| Composite assignment | `+=`, `-=`, `^=`, `*=`, `/=`, `%=`, `\u0026=`, `\\|=`, `^=`, `\u003c\u003c=`, `\u003e\u003e=` |\n| Miscellaneous        | `delete`, `new`, `.`, `()`, `[]`, `?:`                              |\n\nIt is important to note that in many languages, an assignment is a statement that is handled in a special way.\nIn Solidity, like in the C-like languages it took inspiration from, an assignment operator can be freely used in\nexpressions on par with other operators.\n\nIn most cases, built-in operators are only defined for [value types](https://docs.soliditylang.org/en/latest/types.html#value-types).\nNotable exceptions are the simple assignment and the \"miscellaneous\" group.\nFor example, you can put almost anything in parentheses or branches of the ternary operator, as a part\nof a bigger expression, even if its type cannot be named or even assigned to anything.\n\n#### `using for`\n\nSince operators are a purely syntactic element, you can always use a function as a substitute.\nSolidity has a mechanism that is often used this way:\n[`using for`](https://docs.soliditylang.org/en/latest/contracts.html#using-for).\n\nThe directive `using ... for ...` can be used to attach functions to a type.\nThese functions can then be used as members on any object of that type and receive the object as\ntheir first parameter.\n\n```solidity\npragma solidity ^0.8.13;\n\ntype Int is int;\nusing {add} for Int global;\n\nfunction add(Int a, Int b) pure returns (Int) {\n    return Int.wrap(Int.unwrap(a) + Int.unwrap(b));\n}\n\nfunction test(Int a, Int b) pure returns (Int) {\n    return a.add(b);\n}\n```\n\nCurrently, `using for` has 3 forms:\n\n1. `using L for T`: attaches all non-private functions from library `L` to type `T`.\n1. `using L for *`: attaches all non-private functions from library `L` to any type, including types that\n   cannot be named in the language and used explicitly (e.g. types of literals or array slices).\n1. `using {f, L.g, ...} for T`: attaches given free or library functions `f`, `L.g`, ... to type `T`.\n\nThe directive can be used:\n\n- ✅ At file level.\n- ✅ Inside contract and library definitions.\n\nThe directive can not be used:\n\n- ❌ Inside interface definitions.\n\nWhen used inside contracts, it is not inherited.\nIts effects extend only to the contract that has it and not to any other contracts derived from it.\n\nAt file level, the directive affects all the free functions, contracts and libraries defined within that file.\nIt does not affect other files that import the file containing it, unless it is marked as `global`.\n`global` extends its effect to all files.\nThe use of `global` is possible only with UDVTs, structs, and enums that are defined in its source unit.\n\n### Introducing User-Defined Operators\n\nThe new feature extends the third form of the `using for` syntax to allow binding operators to functions.\nThe function is invoked whenever the operator is used on the values of the type:\n\n```solidity\npragma solidity ^0.8.19;\n\ntype Int is int;\nusing {add as +} for Int global;\n\nfunction add(Int a, Int b) pure returns (Int) {\n    return Int.wrap(Int.unwrap(a) + Int.unwrap(b));\n}\n\nfunction test(Int a, Int b) pure returns (Int) {\n    return a + b; // Equivalent to add(a, b)\n}\n```\n\nAn operator can only be bound in a `global` directive and its definition must be a `pure` free function.\nThe type specified in `using for` must be a user-defined value type and must be the type\nof all the parameters of the function and its return value.\nThe only exception are comparison operator definitions, where the return type must be `bool`.\n\nSince currently there are no implicit conversions allowed to and from UDVTs, user-defined operators\nmust always be invoked with exact types.\n\nThe following operators can be defined:\n\n| Category   | Operators                        |\n| ---------- | -------------------------------- |\n| Bitwise    | `\u0026`, `\\|`, `^`, `~`              |\n| Arithmetic | `+`, `-`, `*`, `/`, `%`          |\n| Comparison | `==`, `!=`, `\u003c`, `\u003c=`, `\u003e`, `\u003e=` |\n\nOf the operators listed above, `~` is unary, `-` can be both unary and binary and the rest is always binary.\nNote that Solidity does not have a unary `+`.\nUnary and binary `-` are considered different operators and need separate definitions.\nWhether `-` refers to the unary or binary variant depends on the number of parameters of the function.\n\nIt is not possible to replace operator definitions.\nThis applies both to the built-in operator definitions provided by the compiler and to operators\nbound to a function provided by the user.\nOnce the operator is bound, the definition cannot be changed.\n\n#### Operator Bindings vs Attached Functions\n\nUser-defined operators are independent of attached functions.\nOne can be done without the other, and both can be done simultaneously, even in the same `using for` directive.\n\nThe following example illustrates this:\n\n```solidity\npragma solidity ^0.8.19;\n\ntype Int is int;\nusing {add as +} for Int global;\nusing {sub as -, sub} for Int global;\n\nfunction add(Int a, Int b) pure returns (Int) {\n    return Int.wrap(Int.unwrap(a) + Int.unwrap(b));\n}\n\nfunction sub(Int a, Int b) pure returns (Int) {\n    return Int.wrap(Int.unwrap(a) - Int.unwrap(b));\n}\n\nfunction test(Int x, Int y) pure {\n    x + y;\n    x.add(y); // ERROR: Member \"add\" not found or not visible after argument-dependent lookup in Int.\n\n    x - y;\n    x.sub(y); // OK -- \"sub\" was also attached in \"using for\"\n}\n```\n\nIn the above example, the function `add()` is used _only_ as the operator `+`, and not callable as `x.add(y)`\n(but it can, of course, be also called as `add(x, y)`).\n`sub()`, on the other hand, can both be used as the operator `-` and called on the type.\n\nThe rules for `using for global` with operators are the same as for attached functions\n(with an additional restriction that operators _must_ be global), i.e.\nit is only allowed at file level, the type must be defined in the same file and it makes\nthe operator available everywhere.\nNote that only the directive itself must be colocated with the type.\nThe operator definitions may be imported from a separate file.\n\n#### Parameter Cleanup\n\nIf you decide to use inline assembly in your operator implementation, you should be aware of\na dangerous pitfall when using types that do not fill the whole stack slot.\nAccessing Solidity variables in inline assembly bypasses the\n[variable cleanup](https://docs.soliditylang.org/en/latest/internals/variable_cleanup.html)\nmechanism that normally masks the dirty bits of your value.\nIn inline assembly you must perform that cleanup manually.\n\nConsider an example that naively accesses the parameters and return values of operators\nwithout properly cleaning up `uint8` values:\n\n```solidity\npragma solidity ^0.8.19;\n\ntype U8 is uint8;\nusing {yoloAdd as +, yoloDiv as /} for U8 global;\n\nfunction yoloAdd(U8 x, U8 y) pure returns (U8 z) {\n    assembly {\n        z := add(x, y) // Wrong! No cleanup.\n    }\n}\n\nfunction yoloDiv(U8 x, U8 y) pure returns (U8 z) {\n    assembly {\n        z := div(x, y) // Wrong! No cleanup.\n    }\n}\n\ncontract C {\n    function divAddNoOverflow(U8 a, U8 b, U8 c) external pure returns (U8) {\n        return a / (b + c);\n    }\n}\n```\n\nNow, let's see what happens when you call `divAddNoOverflow(4, 0xff, 3)`.\nYou might expect it to return 4, i.e. `8 / ((255 + 3) % 256)`.\nAfter all, `z` is based on `uint8` and an unchecked addition of 3 to 255 should wrap around and give you 2.\n`8 / 2` is 4.\nThis is not what happens.\nThe actual result is zero.\n\nNote that local variables take up whole stack slots and all calculations in inline assembly are\nperformed on 256-bit numbers.\nThe result of `add(0xff, 3)` is actually `0x0102` and `yoloAdd()` does not clear the higher bits.\n`yoloDiv()` then receives that value as `y`, and again does not clear the higher bits.\nThis results in an integer division by 258 rather than by 2.\n\nThe problem can be avoided with manual cleanup.\nThe code would work as designed if `add(x, y)` was replaced with\n\n```solidity\nand(0xff, add(and(0xff, x), and(0xff, y)))\n```\n\nand `div(x, y)` with\n\n```solidity\nand(0xff, div(and(0xff, x), and(0xff, y)))\n```\n\n#### Examples\n\n##### Unchecked Counter\n\nThis example shows how operators can be used to bypass the checked arithmetic for types\nspecifically defined for cases where those checks are superfluous:\n\n```solidity\npragma solidity ^0.8.19;\n\ntype UncheckedCounter is uint;\n\nusing {add as +, lt as \u003c} for UncheckedCounter global;\n\nUncheckedCounter constant ONE = UncheckedCounter.wrap(1);\n\nfunction add(UncheckedCounter x, UncheckedCounter y) pure returns (UncheckedCounter) {\n    unchecked {\n        return UncheckedCounter.wrap(\n            UncheckedCounter.unwrap(x) +\n            UncheckedCounter.unwrap(y)\n        );\n    }\n}\n\nfunction lt(UncheckedCounter x, UncheckedCounter y) pure returns (bool) {\n    return UncheckedCounter.unwrap(x) \u003c UncheckedCounter.unwrap(y);\n}\n\ncontract C {\n    uint internalCounter = 12;\n\n    function testCounter() public returns (uint) {\n        for (\n            UncheckedCounter i = UncheckedCounter.wrap(12);\n            i \u003c UncheckedCounter.wrap(20);\n            i = i + ONE\n        )\n            ++internalCounter;\n\n        return internalCounter;\n    }\n}\n```\n\n##### A More Complex Abstract Example\n\nThis is a more complex example that shows multiple aspects of user-defined operators.\nThe exact calculations it performs do not matter, the point is to show the syntax in a larger context.\n\n`redBlueScore.sol`\n\n```solidity\npragma solidity ^0.8.19;\n\nimport {Red, Blue, Score, RED_LIMIT, BLUE_LIMIT} from \"./types.sol\";\n\ncontract RedBlueScore {\n    Red public redGauge;\n    Blue public blueGauge;\n\n    function voteRed(Red value, Red base) public {\n        require(-RED_LIMIT \u003c= value * base \u0026\u0026 value * base \u003c= RED_LIMIT);\n        redGauge = redGauge + value * base.exp(3);\n    }\n\n    function voteBlue(Blue value) public {\n        require(-BLUE_LIMIT \u003c= value \u0026\u0026 value \u003c= BLUE_LIMIT);\n        blueGauge = blueGauge + value - Blue.wrap(100);\n    }\n\n    function calculateScore() public view returns (Score) {\n        return\n            redGauge.toScore() / RED_LIMIT.toScore() -\n            blueGauge.toScore() / BLUE_LIMIT.toScore();\n    }\n}\n```\n\n`types.sol`\n\n```solidity\npragma solidity ^0.8.19;\n\nimport \"./operators.sol\" as op;\n\ntype Red is int;\nusing {op.RedLib.toScore, op.RedLib.exp, op.addRed as +, op.mulRed as *, op.unsubRed as -} for Red global;\nusing {op.lteRed as \u003c=, op.gtRed as \u003e} for Red global;\n\ntype Blue is int;\nusing {\n    op.addBlue as +,\n    op.unsubBlue as -,\n    op.subBlue as -,\n    op.BlueLib.toScore,\n    op.lteBlue as \u003c=,\n    op.gtBlue as \u003e\n} for Blue global;\n\ntype Score is int128;\nusing {op.addScore as +} for Score global;\nusing {op.subScore as -} for Score global;\nusing {op.divScore as /} for Score global;\n\nRed constant RED_LIMIT = Red.wrap(10);\nBlue constant BLUE_LIMIT = Blue.wrap(20);\n```\n\n`operators.sol`\n\n```solidity\npragma solidity ^0.8.19;\n\nimport {Red, Blue, Score} from \"./types.sol\";\n\nlibrary RedLib {\n    function toScore(Red x) internal pure returns (Score) {\n        return Score.wrap(int128(Red.unwrap(x))) + Score.wrap(10);\n    }\n\n    function exp(Red x, uint y) internal pure returns (Red) {\n        return Red.wrap(Red.unwrap(x) ** y);\n    }\n}\n\nlibrary BlueLib {\n    function toScore(Blue x) internal pure returns (Score) {\n        return Score.wrap(int128(Blue.unwrap(x))) - Score.wrap(20);\n    }\n\n    function add(Blue x, Blue y) external pure returns (Blue) {\n        return Blue.wrap(Blue.unwrap(x) + Blue.unwrap(y));\n    }\n}\n\nusing {BlueLib.add} for Blue;\n\nfunction addRed(Red x, Red y) pure returns (Red)  { return Red.wrap(Red.unwrap(x) + Red.unwrap(y)); }\nfunction mulRed(Red x, Red y) pure returns (Red)  { return Red.wrap(Red.unwrap(x) * Red.unwrap(y)); }\nfunction unsubRed(Red x)      pure returns (Red)  { return Red.wrap(-Red.unwrap(x)); }\nfunction lteRed(Red x, Red y) pure returns (bool) { return Red.unwrap(x) \u003c= Red.unwrap(y); }\nfunction gtRed(Red x, Red y)  pure returns (bool) { return !(x \u003c= y); }\n\nfunction addBlue(Blue x, Blue y) pure returns (Blue) { return x.add(y); }\nfunction unsubBlue(Blue x)       pure returns (Blue) { return Blue.wrap(-Blue.unwrap(x)); }\nfunction subBlue(Blue x, Blue y) pure returns (Blue) { return x + -y; }\nfunction lteBlue(Blue x, Blue y) pure returns (bool) { return Blue.unwrap(x) \u003c= Blue.unwrap(y); }\nfunction gtBlue(Blue x, Blue y)  pure returns (bool) { return !(x \u003c= y); }\n\nfunction addScore(Score x, Score y) pure returns (Score) { return Score.wrap(Score.unwrap(x) + Score.unwrap(y)); }\nfunction subScore(Score x, Score y) pure returns (Score) { return Score.wrap(Score.unwrap(x) - Score.unwrap(y)); }\nfunction divScore(Score x, Score y) pure returns (Score) { return Score.wrap(Score.unwrap(x) / Score.unwrap(y)); }\n```\n\n### AST Changes\n\nThe new feature introduces two new attributes to the Abstract Syntax Tree (AST) produced by the compiler:\n\n1. `functionList` on `UsingForDirective` nodes can now contain operator entries of the following structure:\n   ```json\n   {\n     \"operator\": \"+\",\n     \"definition\": {\n       /* function */\n     }\n   }\n   ```\n   in addition to the current entries for functions that are structured as follows:\n   ```json\n   {\n     \"function\": {\n       /* function */\n     }\n   }\n   ```\n1. `BinaryOperation` and `UnaryOperation` nodes may now have a `function` attribute.\n   If present, the attribute indicates that the operation is actually an invocation of a user-defined\n   operator and specifies the ID of the function used to define it.\n\nThis effectively introduces a new way to perform a function call not represented by a `FunctionCall` node.\nIt will affect any tool that needs to detect and follow function calls, for example, to build a\ncontrol flow graph.\n\n### Design Rationale\n\n#### Why Does Solidity Need User-Defined Operators?\n\nThe support for user-defined value types in Solidity cannot be considered complete without more natural\nways to operate on them.\nThe ability to use operators was envisioned from the beginning, and the main reason it was not provided\nimmediately was the uncertainty regarding interactions with other features we plan to introduce.\nWe decided that it was best to release the feature in a minimal usable state and extend it over time,\ntaking into account user feedback.\n\nUDVTs in general were meant to fulfill two needs:\n\n1. More type-safety when performing operations on values of the same underlying value type that express\n   conceptually different things.\n   For example quantities of different dimensions could both be stored as `uint` but adding them without\n   an explicit conversion is a mistake that can only be prevented if the compiler knows that they\n   are values of different kinds.\n\n1. The ability to define new types using value types as the underlying representation.\n   The best example of this are fixed-point types.\n\n   Fixed-point types were originally planned to be an integral part of the language, and the\n   partially implemented [`ufixed` and `fixed`](https://docs.soliditylang.org/en/latest/types.html#fixed-point-numbers)\n   types are the vestiges of that old design.\n   While trying to agree on the final design for the feature, however, we realized that no implementation\n   will be a good enough trade-off for most situations and cannot become a suitable default choice.\n   We decided to leave the choice up to library authors and instead focus on providing primitives\n   necessary to build their own fixed-point types that feel like native types.\n   User-defined operators are a step towards that goal.\n\n#### Will User-Defined Operators Make Auditing Harder?\n\nIn the feedback we received so far one of the most common concerns is the effect of the feature on contract\nauditing and potential to mask malicious code.\nWe want to address these concerns here.\n\nFirst of all, any new syntax increases the complexity of the language and has some potential to make code more obscure\nand harder to understand when abused.\nIt cannot be completely avoided and is always a trade-off between all the good and bad ways it can be used.\nWe think that improving the ergonomics of UDVTs is important enough that it outweighs any of the downsides we considered.\n\nThe readability benefits provided by operators cannot be overstated.\nCode containing even relatively simple expressions can be hard to understand at a glance when many function calls are involved:\n\n```solidity\nif (equals(add(mul(a, x), mul(b, y)), add(div(c, z), mod(d, w)))) {\n    return add(div(c, z), mod(d, w));\n}\n```\n\nChaining attached functions somewhat helps by placing the operation name between the arguments (similar to an infix operator):\n\n```solidity\nif (a.mul(x).add(b.mul(y)).equals(c.div(z).add(d.mul(w)))) {\n    return c.div(z).add(d.mod(w)));\n}\n```\n\nIt is, however, still a far cry from the clean, concise notation that can be achieved with the use of operators:\n\n```solidity\nif (a * x + b * y == c / z + d % w) {\n    return c / z + d % w;\n}\n```\n\nThe last example is how we would prefer real code to look like.\nBy the way, did you spot the mistake in the second example?\n\nIt is also essential to realize the actual scope of the feature.\nYou may imagine an elaborate system from languages like C++, with complicated rules and many corner cases.\nAs implemented now the feature is deliberately very limited.\nWe tried both to limit surprises and to avoid prematurely adding support for cases that we have not carefully thought out.\n\nIn the current implementation, it is not possible to:\n\n1. Have operators on types other than UDVTs.\n   - User-defined operators on [reference types](https://docs.soliditylang.org/en/latest/types.html#reference-types)\n     like structs or arrays are not allowed.\n   - It is not possible to define them on built-in value types, function types or enums.\n   - You cannot define them to unnamed types using the type wildcard (`*`).\n1. Have operators that are not `pure`.\n   Operators cannot modify storage.\n   They can, at most, make pure external calls.\n\n   The worst that is technically possible with tricks is for them to modify memory (only through inline assembly)\n   or make staticcalls (through interfaces that do not match deployed code).\n\n1. Have operators on mixed types.\n   Parameter and return value types of operators must be the same.\n   Also, no implicit conversions are possible, so it is very simple to determine if a particular operation\n   will invoke a user-define operator or a built-in one (just look at the type).\n1. Redefine operators.\n   You cannot replace any of the built-in operators with a custom definition.\n   For user-defined operators, only one definition can be provided.\n1. Bind operators to contract functions.\n   This also means that operator definitions cannot be inherited, virtual, or remain unimplemented.\n1. Bind operators to overloaded functions.\n1. Use built-in functions to define operators.\n   You cannot e.g. bind an operator directly to `keccak256()`.\n1. Change the precedence or associativity of an operator.\n1. Define any of the operators with more complex semantics.\n   You cannot define:\n   - `\u0026\u0026` and `||` due to their short-circuiting behavior.\n   - `++` and `--` because they modify their argument and also have separate prefix and postfix variants with different semantics.\n   - `+=`, `-=`, `^=`, `*=`, `/=`, `%=`, `\u0026=`, `|=`, `^=`, `\u003c\u003c=`, `\u003e\u003e=` because they modify their argument.\n   - `=`, `()`, `?:`, and `.` because they are built-in for all types.\n   - `delete`, `new`, and `[]` because they are not usable with UDVTs.\n1. Define custom operators that do not exist in the language, like `===` or unary `+`.\n1. Bind operators in bulk or accidentally.\n   The `using L for T` syntax for attaching a whole library to a type does not cover operators.\n   Operators must always be bound explicitly.\n\nIn addition to these restrictions, we decided to limit them even more in response to feedback we received before releasing Solidity 0.8.18.\nThis means you also cannot:\n\n1. Use library functions to define operators.\n   This excludes external, public, and private functions.\n   It is also now impossible to apply modifiers to operators because free functions cannot have them.\n1. Have non-global operators, which has several consequences:\n   - Operators can only be bound in the file that also defines the type.\n     They are available wherever the type is available and cannot have different definitions in different scopes.\n   - Local bindings at contract level are not possible (i.e. inside contracts and libraries).\n     This also makes it impossible to define operators for local types that are defined inside contracts or libraries.\n1. Define `!`, `\u003c\u003c`, `\u003e\u003e` and `**`.\n\nWe may lift _some_ of these restrictions in the future, but we will consider every case carefully.\nSome of them, like the inability to use overloaded functions, stem from pre-existing limitations of the syntax, but\nothers, like a ban on redefining built-in operators, are very intentional and meant to limit potential misuse.\n\nIn the end, any audit must include a careful review of type definitions and functions, and we think\nthat this will reveal most cases of malicious behavior.\nGiven the above limitations, bad operators cannot do much more than mislead, which is something that\nwill come up in the review of the definition.\nWeird behavior, like `+` that does anything other than perform addition should raise a red flag,\njust like a function called `transfer()` that does not transfer anything.\n\nReviewing the invocations of an operator should not pose significant problems either, as long as\nthe reviewer is aware of the types involved, which is always necessary to understand the expression.\nThis is not a new thing, since the behavior of the built-in operators has always been affected by operand types.\nFor example the overflow semantics of integer types depend on the size of the type in question.\n\nNote that user-defined operators cannot alter semantics of the existing code.\nFor built-in types behavior cannot be altered at all.\nFor UDVTs any operator must necessarily be user-defined so seeing it is not much different from\nseeing a function call.\nAn operator can have only one definition, the definition must be explicitly bound in the file that\ndefines the type and cannot be shadowed.\nIn both cases the name may be misleading and a look at the definition may be necessary.\n\nIt is also worth noting that the feature is meant to be predominantly used in reusable libraries providing common types.\nIn this context, once the library is audited, the concern about operators having misleading or unexpected behavior should be minimal.\n\n### The Future of User-Defined Operators and UDVTs\n\nNow that we know the new feature and its limitations, the question on everyone's mind is probably\n\"Will it stay that way?\".\nHow will the feature evolve in the short and long term?\n\n#### Literal Suffixes\n\nThe very next step for UDVTs is the ability to provide custom literals of user-defined value types.\nThe ease of using literal values in expressions is a big part of what makes a type feel native.\nSolidity already provides fractional literals and our intention is to make them usable with custom\nfixed-point number implementations.\nTo achieve that we are going to allow defining suffix functions that return UDVT by converting\nliterals that are already available in the language:\n\n```solidity\ntype UFixed128x18 is uint128;\n\nfunction uf(int16 mantissa, uint8 exponent) pure suffix returns (UFixed128x18) { ... }\n```\n\n```solidity\nUFixed128x18 circumference = 2 uf * 3.14 uf * radius;\n```\n\nWhile the application of a suffix will involve a function call, eventually, with the help of\ncompile-time evaluation, literal suffixes are going to become as efficient as native literals.\n\n#### More Operators\n\nMany operators have been excluded from the initial implementation.\nSome of them will very likely be user-definable at some point:\n\n1. `\u003c\u003c`, `\u003e\u003e` and `**` were excluded due to their non-uniform arguments.\n   For built-in types, the right-hand side is always an unsigned type.\n1. `!` was excluded because we have to decide whether it should return the same type as the argument\n   or just `bool`.\n   We are leaning towards the latter, but it needs more consideration.\n1. `++` and `--` are very convenient, and we want to have them eventually.\n   They just need to be handled in a special way, and there is more than way to do so.\n1. Composite assignment operators, such as `+=`, will likely be provided automatically\n   in the future as long as the corresponding arithmetic/bitwise operator is available.\n   Allowing a direct implementation is currently not possible anyway, because there are no references\n   to value types in the language.\n\nOn the other hand, it is unlikely that we will allow redefining some other operators:\n\n1. `=` is already provided by the compiler for all types and it is very unlikely that we will ever allow redefining it.\n\n#### Operators on Complex Types\n\nWhile UDVTs were the primary target, in some cases it may also be reasonable to build a custom type\nwith a more complex underlying representation, such as a struct or a dynamic array.\nThe main thing holding us back here are upcoming changes to the type system that are a significant part\nof our roadmap for the near future.\nTo avoid having to introduce breaking changes later, we decided to defer support for such operators until\nthese changes are behind us.\n\n#### What Will Not Change?\n\nDue to concerns about the safety of the feature, there are some key elements that are very unlikely to ever change regarding operators.\nOperators will likely always be global and defined at file level with free functions.\nIt will not be possible to replace built-in opertors or redefine already defined user-defined operators.\n","availableURLs":["/2023/05/10/solidity-0.8.20-release-announcement","/2023/03/10/solidity-developer-survey-2022-results","/2023/02/22/user-defined-operators","/2023/02/22/solidity-0.8.19-release-announcement","/2023/02/01/solidity-0.8.18-release-announcement","/2022/12/07/solidity-developer-survey-2022-announcement","/2022/12/05/solidity-core-team-updates","/2022/09/08/storage-write-removal-before-conditional-termination","/2022/09/08/solidity-0.8.17-release-announcement","/2022/08/08/solidity-0.8.16-release-announcement","/2022/08/08/calldata-tuple-reencoding-head-overflow-bug","/2022/06/15/solidity-0.8.15-release-announcement","/2022/06/15/inline-assembly-memory-side-effects-bug","/2022/06/15/dirty-bytes-array-to-storage-bug","/2022/05/17/solidity-0.8.14-release-announcement","/2022/05/17/data-location-inheritance-bug","/2022/05/17/calldata-reencode-size-check-bug","/2022/05/03/solidity-summit-2022-recap","/2022/04/08/announcing-the-underhanded-contest-winners-2022","/2022/03/16/solidity-0.8.13-release-announcement","/2022/03/16/encodecall-bug","/2022/02/22/solidity-summit-2022-announcement","/2022/02/16/solidity-0.8.12-release-announcement","/2022/02/09/underhanded-solidity-contest-2022-announcement","/2022/02/07/solidity-developer-survey-2021-results","/2021/12/20/solidity-0.8.11-release-announcement","/2021/11/18/solidity-developer-survey-2021","/2021/11/09/solidity-0.8.10-release-announcement","/2021/09/29/user-defined-value-types-bug","/2021/09/29/solidity-0.8.9-release-announcement","/2021/09/29/signed-immutables-bug","/2021/09/27/user-defined-value-types","/2021/09/27/solidity-0.8.8-release-announcement","/2021/08/11/solidity-0.8.7-release-announcement","/2021/06/22/solidity-0.8.6-release-announcement","/2021/06/10/solidity-0.8.5-release-announcement","/2021/05/03/soliditylangorg-umbrella-domain","/2021/04/21/solidity-0.8.4-release-announcement","/2021/04/21/decoding-from-memory-bug","/2021/04/21/custom-errors","/2021/04/01/announcing-solidity-collectibles","/2021/03/23/solidity-0.8.3-release-announcement","/2021/03/23/keccak-optimizer-bug","/2021/03/02/solidity-0.8.2-release-announcement","/2021/03/02/saving-gas-with-simple-inliner","/2021/02/15/contributing-to-solidity-101","/2021/02/10/an-introduction-to-soliditys-fuzz-testing-approach","/2021/02/01/launching-the-solidity-forum","/2021/01/27/solidity-0.8.1-release-announcement","/2021/01/26/solidity-developer-survey-2020-results","/2020/12/16/solidity-v0.8.0-release-announcement","/2020/12/16/solidity-0.7.6-release-announcement","/2020/12/09/solidity-developer-survey-2020","/2020/12/03/solidity-underhanded-contest-winners","/2020/11/18/solidity-0.7.5-release-announcement","/2020/11/04/solidity-ama-1-recap","/2020/10/28/solidity-0.8.x-preview","/2020/10/19/solidity-0.7.4-release-announcement","/2020/10/19/empty-byte-array-copy-bug","/2020/10/07/solidity-dynamic-array-cleanup-bug","/2020/10/07/solidity-0.7.3-release-announcement","/2020/09/28/solidity-0.7.2-release-announcement","/2020/09/21/solidity-underhanded-contest","/2020/09/18/meet-the-team","/2020/09/02/solidity-0.7.1-release-announcement","/2020/07/28/solidity-v0.7.0-release-announcement","/2020/07/22/Solidity-0612-release-announcement","/2020/07/08/solidity-turns-5","/2020/07/07/Solidity-0611-release-announcement","/2020/06/25/sourcify-faq","/2020/06/18/solidity-0.6-inheritance","/2020/06/11/Solidity-0610-release-announcement","/2020/06/09/solidity-summit-recap","/2020/06/05/Solidity-069-release-announcement","/2020/06/02/Sourcify-Towards-Safer-Contract-Interaction-for-Humans","/2020/05/26/array-slices","/2020/05/14/Solidity-068-release-announcement","/2020/05/13/immutable-keyword","/2020/05/04/solidity-0.6.7-release-announcement","/2020/04/17/Solidity-Summit-2020-Goes-Interspace","/2020/04/09/solidity-0.6.6-release-announcement","/2020/04/06/solidity-0.6.5-release-announcement","/2020/04/06/memory-creation-overflow-bug","/2020/03/23/fallback-receive-split","/2020/03/17/solidity-0.5.17-release-announcement","/2020/03/10/solidity-0.6.4-release-announcement","/2020/02/18/solidity-0.6.3-release-announcement","/2020/01/29/solidity-0.6-try-catch","/2020/01/27/solidity-0.6.2-release-announcement","/2020/01/02/solidity-0.6.1-release-announcement","/2020/01/02/solidity-0.5.16-release-announcement","/2019/12/17/solidity-0.6.0-release-announcement","/2019/12/17/solidity-0.5.15-release-announcement","/2019/12/09/solidity-0.5.14-release-announcement","/2019/11/14/solidity-0.5.13-release-announcement","/2019/10/01/solidity-0.5.12-release-announcement","/2019/08/12/solidity-0.5.11-release-announcement","/2019/06/25/solidity-storage-array-bugs","/2019/06/25/solidity-0.5.10-release-announcement","/2019/05/28/solidity-0.5.9-release-announcement","/2019/04/30/solidity-0.5.8-release-announcement","/2019/04/29/solidity-0.4.26-release-announcement","/2019/03/26/solidity-optimizer-and-abiencoderv2-bug","/2019/03/26/solidity-0.5.7-release-announcement","/2019/03/13/solidity-0.5.6-release-announcement","/2019/03/05/solidity-0.5.5-release-announcement","/2019/02/12/solidity-0.5.4-release-announcement","/2019/01/22/solidity-0.5.3-release-announcement","/2018/12/19/solidity-0.5.2-release-announcement","/2018/12/03/solidity-0.5.1-release-announcement","/2018/11/13/solidity-0.5.0-release-announcement","/2018/09/13/solidity-bugfix-release","/2018/09/13/solidity-0.4.25-release-announcement","/2018/05/16/solidity-0.4.24-release-announcement","/2018/04/19/solidity-0.4.23-release-announcement","/2018/04/17/solidity-0.4.22-release-announcement","/2018/03/08/solidity-0.4.21-release-announcement","/2018/02/14/solidity-0.4.20-release-announcement","/2017/11/30/solidity-0.4.19-release-announcement","/2017/10/18/solidity-0.4.18-release-announcement","/2017/09/21/solidity-0.4.17-release-announcement","/2017/08/24/solidity-0.4.16-release-announcement","/2017/08/08/solidity-0.4.15-release-announcement","/2017/07/31/solidity-0.4.14-release-announcement","/2017/07/06/solidity-0.4.13-release-announcement","/2017/07/03/solidity-0.4.12-release-announcement","/2017/05/03/solidity-optimizer-bug","/2017/05/03/solidity-0.4.11-release-announcement","/2017/03/15/solidity-0.4.10-release-announcement","/2017/01/31/solidity-0.4.9-release-announcement","/2017/01/13/solidity-0.4.8-release-announcement","/2016/12/15/solidity-0.4.7-release-announcement","/2016/11/22/solidity-0.4.6-release-announcement","/2016/11/21/solidity-0.4.5-release-announcement","/2016/11/09/analysis-storage-corruption-bug","/2016/11/01/solidity-0.4.4-release-announcement","/2016/11/01/security-alert-solidity-variables-can-overwritten-storage","/2016/10/25/solidity-0.4.3-release-announcement","/2016/09/17/solidity-0.4.2-release-announcement","/2016/09/09/solidity-0.4.1-release-announcement","/2016/09/08/solidity-0.4.0-release-announcement","/2016/09/01/formal-methods-roadmap","/2016/08/10/solidity-0.3.6-release-announcement","/2016/06/10/solidity-0.3.5-release-announcement","/2016/06/10/smart-contract-security","/2016/05/31/solidity-0.3.4-release-announcement","/2016/05/27/solidity-0.3.3-release-announcement","/2016/04/18/solidity-0.3.2-release-announcement","/2016/03/31/solidity-0.3.1-release-announcement","/2016/03/11/solidity-0.3.0-release-announcement","/2016/02/17/solidity-0.2.2-release-announcement","/2016/01/30/solidity-0.2.1-release-announcement","/2015/12/01/solidity-0.2.0-release-announcement","/2015/11/17/solidity-0.1.7-release-announcement","/2015/10/16/solidity-0.1.6-release-announcement","/2015/10/07/solidity-0.1.5-release-announcement","/2015/09/30/solidity-0.1.4-release-announcement","/2015/09/22/solidity-0.1.3-release-announcement","/2015/08/21/solidity-0.1.2-release-announcement"]},"__N_SSG":true},"page":"/blog/[YYYY]/[MM]/[DD]/[post]","query":{"YYYY":"2023","MM":"02","DD":"22","post":"user-defined-operators"},"buildId":"Fngo94tbif38FilQuSLQv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>